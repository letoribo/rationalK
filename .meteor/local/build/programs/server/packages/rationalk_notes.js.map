{"version":3,"sources":["rationalk:notes/lib/methods.js","rationalk:notes/lib/collections.js","rationalk:notes/lib/routes.js","rationalk:notes/lib/server/publications.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,a;AACA,iC;AACA,G;AACA,oB;AACA,G;AACA,E;;AAEA,6C;AACA,c;AACA,8D;AACA,Y;AACA,E;;AAEA,+C;AACA,S;AACA,6B;AACA,kB;AACA,K;AACA,c;AACA,6B;AACA,Q;AACA,M;AACA,K;AACA,gD;AACA,8C;AACA,gB;AACA,O;AACA,c;AACA,E;;AAEA,iC;AACA,2E;AACA,E;;AAEA,gB;AACA,yC;AACA,e;AACA,I;AACA,6B;AACA,K;AACA,I;AACA,wB;AACA,6B;AACA,qB;AACA,sC;AACA,K;AACA,I;AACA,oB;AACA,I;AACA,I;AACA,uC;AACA,8C;AACA,G;AACA,G;AACA,G;;;;;;;;;;;;;;;;;;;ACtDA,sC;;AAEA,c;AACA,iD;AACA,gD;AACA,kD;AACA,G;;AAEA,sB;AACA,+C;AACA,gE;AACA,E;AACA,O;AACA,iD;AACA,iE;AACA,G;AACA,E;AACA,C;;;;;;;;;;;;;;;;;;;ACjBA,wC;AACA,0B;AACA,kB;AACA,yB;AACA,c;AACA,oC;AACA,oC;AACA,Q;AACA,M;AACA,K;;AAEA,mC;AACA,qK;AACA,0B;AACA,K;AACA,2B;AACA,uC;AACA,K;AACA,I;AACA,C;;;;;;;;;;;;;;;;;;;ACnBA,uC;AACA,2C;AACA,G","file":"/packages/rationalk_notes.js","sourcesContent":["RKNotes = {};\nRKCore.searchResultsPackage.push(\n  {\n    name: \"RKNotes\",\n  }\n);\n\nRKNotes.findAllFullTextSearch = function () {\n  var sr = [];\n  sr = sr.concat(Notes.find({}, {sort: {score: -1}}).fetch());\n  return sr;\n};\n\nRKNotes.findFullText = function (searchQuery) {\n  var sr;\n  check(searchQuery, String);\n  sr = Notes.find(\n    {\n      $text: {\n        $search: searchQuery,\n      },\n    },\n    {\n      fields: { score: { $meta: 'textScore' } },\n      sort: { score: { $meta: 'textScore' } },\n      limit: 30,\n    });\n    return sr;\n};\n\nRKNotes.findDummy = function () {\n  return Notes.find({$text: { $search: \"somethingthatyouwillneverfind\" }});\n};\n\nMeteor.methods({\n\tupdateNote: function (content, userId) {\n\t\tNotes.update(\n\t\t\t{\n\t\t\t  userId: Meteor.userId(),\n\t\t\t},\n\t\t\t{\n\t\t\t    content: content,\n\t\t\t    updatedAt: new Date(),\n\t\t\t\t  userId: userId,\n          searchResultFromNotes: true,\n\t\t\t},\n\t\t\t{\n\t\t\t    upsert: true,\n\t\t\t}\n\t\t);\n\t\tif (typeof(toastr) !== 'undefined') {\n\t\t\ttoastr.success('Note updated succesfully');\n\t\t}\n\t},\n});\n","Notes = new Mongo.Collection('notes');\n\nNotes.allow( {\n\t\tinsert: function (userId) {return !! userId; },\n\t\tupdate: function (userId) {return !!userId; },\n    remove: function (userId) {return !!userId; },\n});\n\nif (Meteor.isServer) {\n\tif (typeof Notes.createIndex === 'function') {\n\t\tNotes.createIndex({ content: \"text\" }, { name: \"TextIndex\" });\n\t}\n\telse {\n\t\tif (typeof Notes._ensureIndex === 'function') {\n\t\t\tNotes._ensureIndex( { content: \"text\" }, {name: \"TextIndex\"});\n\t\t}\n\t}\n}\n","if (Meteor.settings.public.show.notes) {\n  Router.route(\"/notes\", {\n    name: \"notes\",\n    waitOn: function () {\n      return [\n        Meteor.subscribe(\"myNotes\"),\n        Meteor.subscribe(\"members\"),\n      ];\n    },\n  });\n\n  url = Router.routes.notes.path();\n  menuHTML = new Spacebars.SafeString('<li><a href=\"' + url + '\" title=\"My notes\"><strong><span class=\"glyphicon glyphicon-pencil\"></span></strong> Notes</a></li>');\n  RKCore.packageMenu.push(\n    {\n      \"menuHTML\": menuHTML,\n      \"fromPackage\": \"rationalk:notes\",\n    }\n  );\n}\n","Meteor.publish(\"myNotes\", function () {\n  return Notes.find({userId: this.userId});\n});\n"]}