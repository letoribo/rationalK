{"version":3,"sources":["rationalk:cse/lib/methods.js","rationalk:cse/lib/collections.js","rationalk:cse/lib/server/publications.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,W;;AAEA,6B;AACA,iC;AACA,E;;AAEA,6C;AACA,iC;AACA,gB;AACA,+B;AACA,U;AACA,Q;AACA,kD;AACA,gD;AACA,kB;AACA,O;AACA,E;;AAEA,+B;AACA,sF;AACA,E;;;;;;;;;;;;;;;;;;;ACpBA,4D;;AAEA,yB;AACA,iD;AACA,gD;AACA,kD;AACA,G;;;AAGA,mC;AACA,0C;;;;;;;;;;;;;;;;;;;ACVA,wC;AACA,kB;AACA,e;AACA,Y;AACA,U;AACA,uB;AACA,mD;AACA,c;AACA,S;AACA,gF;AACA,iB;AACA,mB;AACA,qC;AACA,uC;AACA,U;AACA,S;AACA,mD;AACA,gE;AACA,oD;AACA,S;AACA,c;AACA,+C;AACA,S;AACA,e;AACA,uB;AACA,4B;AACA,0B;AACA,gC;AACA,U;;AAEA,yD;AACA,S;AACA,mB;AACA,K;AACA,kB;AACA,yB;AACA,K;AACA,G;AACA,Q;AACA,iB;AACA,G;AACA,G;AACA,Q;AACA,8E;AACA,G;AACA,G","file":"/packages/rationalk_cse.js","sourcesContent":["RKCSE = {};\n\nRKCSE.findAll = function () {\n  return WebSearchResults.find();\n};\n\nRKCSE.findFullText = function (searchQuery) {\n  return WebSearchResults.find( {\n        $text: {\n          $search: searchQuery,\n        },\n    }, {\n        fields: { score: { $meta: 'textScore' } },\n        sort: { score: { $meta: 'textScore' } },\n        limit: 30,\n    });\n};\n\nRKCSE.findDummy = function () {\n  return WebSearchResults.find({$text: { $search: \"somethingthatyouwillneverfind\" }});\n};\n","WebSearchResults = new Mongo.Collection('websearchresults');\n\nWebSearchResults.allow( {\n\t\tinsert: function (userId) {return !! userId; },\n\t\tupdate: function (userId) {return !!userId; },\n    remove: function (userId) {return !!userId; },\n});\n\n\n//expose it to the other packages :\nRKCSE.WebSearchResults = WebSearchResults;\n","Meteor.publish('cse', function (query) {\n  var self = this;\n  var response;\n  var thumb;\n  var doc;\n  check(query, String);\n  if (typeof Meteor.settings.cse !== 'undefined') {\n  if (query) {\n    try {\n      response = Meteor.http.get('https://www.googleapis.com/customsearch/v1', {\n        params: {\n          q: query,\n          cx: Meteor.settings.cse.cx,\n          key: Meteor.settings.cse.key,\n        },\n      });\n      _.each(response.data.items, function (item) {\n        if (typeof item.pagemap.cse_thumbnail !== 'undefined') {\n          thumb = item.pagemap.cse_thumbnail[0].src;\n        }\n        else {\n          thumb = \"/images/noimgavailable.png\";\n        }\n        doc = {\n          thumb: thumb,\n          title: item.title,\n          link: item.link,\n          snippet: item.snippet,\n        };\n\n        self.added('websearchresults', Random.id(), doc);\n      });\n      self.ready();\n    }\n    catch(error) {\n      console.log(error);\n    }\n  }\n  else {\n    self.ready();\n  }\n  }\n  else {\n    console.log(\"You need to defined cse in your setting file settings.json\");\n  }\n});"]}