)]}'
{"version":3,"file":"/packages/schnie:uploader.js","sources":["schnie:uploader/lib/uploadedFiles.coffee","schnie:uploader/lib/UploaderFile.coffee","schnie:uploader/client/views/uploader.html","schnie:uploader/client/views/uploader.coffee","schnie:uploader/client/UploaderState.coffee"],"names":[],"mappings":"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","sourcesContent":["@UploadedFiles = new Meteor.Collection \"uploadedFiles\"\n\n@UploadedFiles.allow\n  insert: (userId, doc) ->\n    true\n\n  update: (userId, doc, fieldNames, modifier) ->\n    true\n\n  remove: (userId, doc) ->\n    true\n","class @UploaderFile\n\n  CHUNK_SIZE: 1024 * 1024 * 0.5\n\n  @fromJSONValue: (value) ->\n    new UploaderFile\n      id: value.id\n      name: value.name\n      ext: value.ext\n      type: value.type\n      size: value.size\n      data: EJSON.fromJSONValue value.data\n      start: value.start\n      end: value.end\n      bytesRead: value.bytesRead\n      bytesUploaded: value.bytesUploaded\n    ,\n      value.settings\n\n\n  constructor: (doc = {}, settings={}) ->\n    @id = doc.id or Random.id()\n    @name = doc.name or null\n    @type = doc.type or null\n    @data = doc.data or null\n    @size = doc.size or 0\n    @start = doc.start or 0\n    @end = doc.end or 0\n    @bytesRead = doc.bytesRead or 0\n    @bytesUploaded = doc.bytesUploaded or 0\n    @ext = @name?.match(/\\.[0-9a-z]{1,5}$/i)\n    @settings = settings\n\n  typeName: ->\n    \"UploaderFile\"\n\n  equals: (id) ->\n    @id = other.id\n\n  clone: ->\n    new UploaderFile\n      id: @id\n      name: @name\n      type: @type\n      size: @size\n      data: @data\n      start: @start\n      end: @end\n      bytesRead: @bytesRead\n      bytesUploaded: @bytesUploaded\n    ,\n      @settings\n\n  toJSONValue: ->\n    id: @id\n    name: @name\n    type: @type\n    size: @size\n    data: EJSON.toJSONValue @data\n    start: @start\n    end: @end\n    bytesRead: @bytesRead\n    bytesUploaded: @bytesUploaded\n    settings: @settings\n\n  getDocument: ->\n    UploadedFiles.findOne _id: @id\n\n  getTotalProgress: ->\n    file = @getDocument()\n    uploadProgress = file.uploadProgress or 0\n    cloudUploadProgress = file.cloudUploadProgress or 0\n    uploadProgress/2 + cloudUploadProgress/2\n\n\n\nEJSON.addType \"UploaderFile\", UploaderFile.fromJSONValue\n\n#\n# Client\n#\nif Meteor.isClient\n\n  UploaderFile.upload = (uploaderId, file, settings={}) ->\n    new UploaderFile({}, settings).upload uploaderId, file\n\n\n  UploaderFile::rewind = ->\n    @data = null\n    @start = 0\n    @end = 0\n    @bytesRead = 0\n    @bytesUploaded = 0\n\n  UploaderFile::_updateStatus = ->\n    readProgress = Math.round @bytesRead/@size * 100\n    uploadProgress = Math.round @bytesUploaded/@size * 100\n\n    UploadedFiles.update _id: @id,\n      $set: readProgress: readProgress, uploadProgress: uploadProgress\n\n  UploaderFile::upload = (uploaderId, file) ->\n    @name = file.name\n    @size = file.size\n    @type = file.type\n\n    UploadedFiles.insert\n      _id: @id\n      name: @name\n      type: @type\n      size: @size\n      uploaderId: uploaderId\n      readProgress: 0\n      uploadProgress: 0\n      cloudUploadProgress: 0\n\n    @read file\n    return @\n\n  # Recursively read and transmit the file\n  UploaderFile::read = (file) ->\n    if @bytesUploaded < @size\n      @start = @end\n      @end += @CHUNK_SIZE\n\n      if @end > @size\n        @end = @size\n\n      reader = new FileReader\n      reader.onload = =>\n        @bytesRead += @end - @start\n        @data = new Uint8Array reader.result\n        Meteor.call \"uploadChunk\", @, (error, result) =>\n          if error\n            @rewind()\n            @_updateStatus()\n            throw error\n          else\n            @bytesUploaded += @data.length\n            @_updateStatus()\n            @read file\n\n      blob = file.slice @start, @end\n      reader.readAsArrayBuffer blob\n    else\n      @_updateStatus()\n\n\n#\n# Server\n#\nif Meteor.isServer\n  fs = Npm.require \"fs\"\n  path = Npm.require \"path\"\n  Knox = Npm.require \"knox\"\n\n  UploaderFile::_updateStatus = (progress) ->\n    UploadedFiles.update _id: @id,\n      $set: cloudUploadProgress: progress.percent\n\n  UploaderFile::_updateCloudUrl = (url) ->\n    UploadedFiles.update _id: @id,\n      $set: url: url\n\n  UploaderFile::_setError = (error) ->\n    UploadedFiles.update _id: @id,\n      $set: error: error\n\n  UploaderFile::save = (dirPath) ->\n    filePath = path.resolve path.join \"\", \"#{@id}#{@ext}\"\n    buffer = new Buffer @data\n    mode = if @start is 0 then 'w' else 'a'\n    fd = fs.openSync filePath, mode\n    fs.writeSync fd, buffer, 0, buffer.length, @start\n    fs.closeSync fd\n\n    if @end is @size\n      @upload filePath\n\n  UploaderFile::upload = (filePath) ->\n    config = Uploader.getConfig()\n    knox = Knox.createClient config\n\n    cloudPath = \"#{@id}#{@ext}\"\n    if @settings.directory?\n      cloudPath = @settings.directory.replace(/\\/?$/, '/').concat cloudPath\n\n    put = knox.putFile filePath, cloudPath, Meteor.bindEnvironment (error, response) =>\n      fs.unlinkSync filePath\n      if response\n        @_updateCloudUrl knox.http(cloudPath)\n      if error\n        @_setError new Meteor.Error 500, \"An error occured transferring #{@name}\"\n\n    put.on \"progress\", Meteor.bindEnvironment (progress) =>\n      @_updateStatus progress\n\n    # put.on \"error\", Meteor.bindEnvironment (error) =>\n    #   @_setError new Meteor.Error 500, \"An error occured transferring #{@name}\"\n    #   fs.unlinkSync filePath\n","\nTemplate.__define__(\"uploader\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"uploader-controls\"\n  }, \"\\n\\n    \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"filesSelected\"));\n  }, function() {\n    return [ \"\\n\\n      \", HTML.Comment(\" PROGRESS BAR \"), \"\\n      \", HTML.DIV({\n      \"class\": \"progress progress-striped\"\n    }, \"\\n        \", HTML.DIV({\n      \"class\": function() {\n        return [ \"progress-bar \", Blaze.If(function() {\n          return Spacebars.call(view.lookup(\"complete\"));\n        }, function() {\n          return \"progress-bar-success\";\n        }) ];\n      },\n      role: \"progressbar\",\n      \"aria-valuenow\": function() {\n        return Spacebars.mustache(view.lookup(\"progress\"));\n      },\n      \"aria-valuemin\": \"0\",\n      \"aria-valuemax\": \"100\",\n      style: function() {\n        return [ \"width: \", Spacebars.mustache(view.lookup(\"progress\")), \"%\" ];\n      }\n    }, \"\\n          \", HTML.SPAN(Blaze.View(function() {\n      return Spacebars.mustache(view.lookup(\"progress\"));\n    }), \"%\"), \"\\n        \"), \"\\n      \"), \"\\n      \", Blaze.If(function() {\n      return Spacebars.call(view.lookup(\"multipleQueue\"));\n    }, function() {\n      return [ \"\\n        \", HTML.SPAN(\"Uploading \", Blaze.View(function() {\n        return Spacebars.mustache(view.lookup(\"currentlyUploading\"));\n      }), \" of \", Blaze.View(function() {\n        return Spacebars.mustache(view.lookup(\"queueSize\"));\n      })), \"\\n      \" ];\n    }), \"\\n\\n    \" ];\n  }, function() {\n    return [ \"\\n\\n      \", HTML.Comment(\" UPLOAD BUTTON \"), \"\\n      \", HTML.INPUT({\n      type: \"file\",\n      accept: function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"settings\"), \"accept\"));\n      },\n      multiple: function() {\n        return Spacebars.mustache(Spacebars.dot(view.lookup(\"settings\"), \"multiple\"));\n      },\n      \"class\": \"hidden file-upload\"\n    }), \"\\n      \", Blaze.If(function() {\n      return Spacebars.call(view.templateContentBlock);\n    }, function() {\n      return [ \"\\n        \", Blaze.InOuterTemplateScope(view, function() {\n        return Spacebars.include(function() {\n          return Spacebars.call(view.templateContentBlock);\n        });\n      }), \"\\n      \" ];\n    }, function() {\n      return [ \"\\n        \", HTML.BUTTON({\n        type: \"button\",\n        \"class\": \"btn btn-default btn-block file-upload-button\"\n      }, \"\\n          \", HTML.SPAN({\n        \"class\": \"glyphicon glyphicon-cloud-upload fa fa-cloud-upload\"\n      }), \"\\n          Upload\\n        \"), \"\\n      \" ];\n    }), \"\\n    \" ];\n  }), \"\\n\\n  \");\n}));\n","clickHandler = (event, tpl) ->\n  event.preventDefault()\n  $(tpl.find(\".file-upload\")).click()\n\ndataURLToBlob = (dataUrl) ->\n  binaryImg = window.atob(dataUrl.slice(dataUrl.indexOf(\"base64\") + 7, dataUrl.length))\n  length = binaryImg.length\n  ab = new ArrayBuffer length\n  ua = new Uint8Array ab\n  i = 0\n  while i < length\n    ua[i] = binaryImg.charCodeAt(i)\n    i++\n  new Blob([ua])\n\ngetFile = (id) ->\n  files = @stateManager.get \"files\"\n  file = _.findWhere files, id: id\n\ngetFileDocument = (id) ->\n  file = getFile.call @, id\n  if file? then file.getDocument()\n\nremoveFile = (id) ->\n  files = @stateManager.get \"files\"\n  files = _.reject files, (file) -> file.id is id\n  @stateManager.set \"files\", files\n\naddFile = (file) ->\n  files = @stateManager.get \"files\"\n  files.push file\n  @stateManager.set \"files\", files\n\nprogress = ->\n  tpl = UI._templateInstance()\n  files = tpl.stateManager.get \"files\"\n  total = _.reduce files, (memo, val) ->\n    memo += val.getTotalProgress()\n  , 0\n  Math.round (total / _.size(files)*100 / 100)\n\nreset = ->\n  @stateManager.set \"files\", []\n\nwatchFilesCollection = ->\n  Meteor.subscribe \"uploadedFiles\", @uploaderId\n  UploadedFiles.find().observeChanges\n    changed: (id, fields) =>\n      if fields.url?\n        file = getFileDocument.call @, id\n        if file?\n          @data.settings.onUpload? null, file\n\n      if fields.error?\n        err = fields.error\n        file = getFileDocument.call @, id\n        if file?\n          removeFile.call @, id\n          @data.settings.onUpload? new Meteor.Error(err.error, err.reason), file\n\n      allDone =  _.every @stateManager.get(\"files\"), (file) ->\n        file.getDocument()?.url\n\n      if allDone then reset.call @\n\n\n\nTemplate.uploader.created = ->\n  @uploaderId = Random.id()\n  @stateManager = new UploaderState @uploaderId\n  reset.call @\n  watchFilesCollection.call @\n\nTemplate.uploader.helpers\n  progress: progress\n\n  complete: ->\n    progress() is 100\n\n  filesSelected: ->\n    tpl = UI._templateInstance()\n    tpl.stateManager.get \"files\"\n\nTemplate.uploader.events\n  # Upload button\n  \"click button\": (event, tpl) ->\n    clickHandler event, tpl\n\n  # Or anchor\n  \"click a\": (event, tpl) ->\n    clickHandler event, tpl\n\n  # After file(s) have been chosen\n  \"change input[type=file]\": (event, tpl) ->\n    settings = tpl.data.settings\n    files = event.currentTarget.files\n\n    if settings.onSelection?\n      settings.onSelection files\n\n    _.each files, (file) =>\n      if settings.manipulateImage? and file.type.match(/image.*/)?\n        reader = new FileReader\n        reader.onload = =>\n          settings.manipulateImage reader.result, file, (dataUrl) =>\n            blob = dataURLToBlob dataUrl\n            blob.name = file.name\n            uFile = UploaderFile.upload tpl.uploaderId, blob, settings\n            addFile.call tpl, uFile\n        reader.readAsDataURL file\n      else\n        uFile = UploaderFile.upload tpl.uploaderId, file, settings\n        addFile.call tpl, uFile\n","class @UploaderState extends ReactiveDict\n\n  constructor: (@uploaderId) ->\n    super()\n\n  _getKey: (key) ->\n    \"#{@uploaderId}-#{key}\"\n\n  set: (key, value) ->\n    super @_getKey(key), value\n\n  get: (key) ->\n    super @_getKey(key)\n"]}