{"version":3,"sources":["rationalk:filecontent//Users/thomasdokithonon/rationalK/packages/rationalk-filecontent/package-tap.i18n","rationalk:filecontent/lib/methods.js","rationalk:filecontent/lib/collections.js","rationalk:filecontent/lib/routes.js","rationalk:filecontent/lib/client/settings.html","rationalk:filecontent/lib/client/settings.js","rationalk:filecontent/lib/client/filesContentInSearchResults.html","rationalk:filecontent/lib/client/filesContentInSearchResults.js","rationalk:filecontent//Users/thomasdokithonon/rationalK/packages/rationalk-filecontent/i18n/en.i18n.json","rationalk:filecontent//Users/thomasdokithonon/rationalK/packages/rationalk-filecontent/i18n/fr.i18n.json"],"names":[],"mappings":";;;;;;;;AAAA,uH;;AAEA,+D;AACA,gD;AACA,2C;AACA,iF;AACA,uH;;AAEA,qD;AACA,6B;AACA,yC;;;;;;;;;;;;;;;;;;;ACVA,oB;AACA,iC;AACA,iC;AACA,G;AACA,yG;AACA,G;AACA,E;;AAEA,oD;AACA,4D;AACA,E;;AAEA,sD;AACA,S;AACA,yB;AACA,K;AACA,c;AACA,6B;AACA,Q;AACA,M;AACA,K;AACA,gD;AACA,8C;AACA,gB;AACA,O;AACA,yC;AACA,2B;AACA,Y;AACA,E;;AAEA,wC;AACA,kF;AACA,E;;;;;;;;;;;;;;;;;;;AChCA,oD;;AAEA,qB;AACA,iD;AACA,gD;AACA,kD;AACA,G;;AAEA,sB;AACA,sD;AACA,oE;AACA,E;AACA,O;AACA,wD;AACA,qE;AACA,G;AACA,E;AACA,C;;AAEA,iC;AACA,2D;;;;;;;;;;;;;;;;;;;ACpBA,8C;;AAEA,C;;;;;;;;;;;;;;;;;;;;ACDA,6C;AACA,8F;AACA,kB;AACA,mB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,2B;AACA,6B;AACA,8B;AACA,0B;AACA,0B;AACA,wC;AACA,iE;AACA,wC;AACA,yB;AACA,iC;AACA,mB;AACA,wC;AACA,c;AACA,gC;AACA,uB;AACA,sF;AACA,K;AACA,wC;AACA,oF;AACA,2C;AACA,c;AACA,kC;AACA,uB;AACA,kF;AACA,K;AACA,wC;AACA,gF;AACA,kE;AACA,I;;;;;;;;;;;;;;;;;;;ACtCA,sC;AACA,4C;AACA,uB;AACA,gE;AACA,gB;AACA,mE;AACA,wB;AACA,O;AACA,mB;AACA,qE;AACA,0B;AACA,K;AACA,O;AACA,iB;AACA,I;AACA,8C;AACA,uB;AACA,iE;AACA,kB;AACA,oE;AACA,wB;AACA,O;AACA,mB;AACA,sE;AACA,0B;AACA,K;AACA,O;AACA,iB;AACA,I;AACA,G;;;AAGA,uC;;AAEA,G;;;;;;;;;;;;;;;;;;;;ACjCA,oD;AACA,4G;AACA,kB;AACA,mB;AACA,mB;AACA,uB;AACA,kB;AACA,wB;AACA,wB;AACA,iE;AACA,wD;AACA,oC;AACA,uB;AACA,0B;AACA,kC;AACA,wC;AACA,gE;AACA,kE;AACA,qE;AACA,iB;AACA,kE;AACA,kE;AACA,0D;AACA,0D;AACA,oB;AACA,gC;AACA,I;;;;;;;;;;;;;;;;;;;AC3BA,6C;AACA,0C;AACA,sB;AACA,qC;AACA,qC;AACA,I;AACA,mD;AACA,qE;AACA,4C;AACA,gE;AACA,mB;AACA,G;AACA,G;;;AAGA,8C;AACA,wB;AACA,qC;AACA,G;AACA,0C;AACA,uD;AACA,G;AACA,2B;AACA,qD;AACA,uB;AACA,G;AACA,wB;AACA,mC;AACA,wC;AACA,G;AACA,2B;AACA,4C;AACA,wC;AACA,I;AACA,6B;AACA,iD;AACA,2B;AACA,M;AACA,iC;AACA,G;AACA,kC;AACA,iD;AACA,6C;AACA,M;AACA,wC;AACA,E;AACA,G;;AAEA,gD;AACA,sE;AACA,E;;;;;;;;;;;;;;;;;;;AClDA,6B;AACA,2C;AACA,wC;;AAEA,gC;AACA,yD;AACA,C;AACA,gD;AACA,kB;AACA,wG;AACA,gD;AACA,8E;;AAEA,oD;AACA,8C;;AAEA,yC;AACA,C;;;;;;;;;;;;;;;;;;;ACjBA,6B;AACA,2C;AACA,wC;;AAEA,gC;AACA,yD;AACA,C","file":"/packages/rationalk_filecontent.js","sourcesContent":["TAPi18n.packages[\"rationalk:filecontent\"] = {\"translation_function_name\":\"__\",\"helper_name\":\"_\",\"namespace\":\"project\"};\n\n// define package's translation function (proxy to the i18next)\n__ = TAPi18n._getPackageI18nextProxy(\"project\");\n// define the package's templates registrar\nregisterI18nTemplate = TAPi18n._getRegisterHelpersProxy(\"rationalk:filecontent\");\nregisterTemplate = registerI18nTemplate; // XXX OBSOLETE, kept for backward compatibility will be removed in the future\n\n// Record the list of templates prior to package load\nvar _ = Package.underscore._;\nnon_package_templates = _.keys(Template);\n","RKFilesContent = {};\nRKFilesContent.Collections =  {};\nRKCore.searchResultsPackage.push(\n  {\n    name: \"RKFilesContent\", // a publication with the name : RKSheetConnector-searchResults should exists\n  }\n);\n\nRKFilesContent.findAllFullTextSearch = function () {\n  return FilesContent.find({}, {sort: {score: -1}}).fetch();\n};\n\nRKFilesContent.findFullText = function (searchQuery) {\n  var sr;\n  sr = FilesContent.find(\n    {\n      $text: {\n        $search: searchQuery,\n      },\n    },\n    {\n      fields: { score: { $meta: 'textScore' } },\n      sort: { score: { $meta: 'textScore' } },\n      limit: 30,\n    });\n    RKCore.log(\"I am here FilesContent\");\n    RKCore.log(sr.fetch());\n  return sr;\n};\n\nRKFilesContent.findDummy = function () {\n  return FilesContent.find({$text: { $search: \"somethingthatyouwillneverfind\" }});\n};\n","FilesContent = new Mongo.Collection('FilesContent');\n\nFilesContent.allow( {\n\t\tinsert: function (userId) {return !! userId; },\n\t\tupdate: function (userId) {return !!userId; },\n    remove: function (userId) {return !!userId; },\n});\n\nif (Meteor.isServer) {\n\tif (typeof FilesContent.createIndex === 'function') {\n\t\tFilesContent.createIndex({ text: \"text\" }, { name: \"TextIndex\" });\n\t}\n\telse {\n\t\tif (typeof FilesContent._ensureIndex === 'function') {\n\t\t\tFilesContent._ensureIndex( { text: \"text\" }, {name: \"TextIndex\"});\n\t\t}\n\t}\n}\n\n// Expose collections if needed :\n//RKWiki.Collections.WikiSearchResults = WikiSearchResults;\n","if (Meteor.settings.public.show.filecontent) {\n\n}\n","\nTemplate.__checkName(\"settingsFilesContent\");\nTemplate[\"settingsFilesContent\"] = new Template(\"Template.settingsFilesContent\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\t\", HTML.DIV({\n    \"class\": \"panel-heading\",\n    style: \"position:relative\"\n  }, \"\\n\t\t\t\t\t\t\", HTML.H3({\n    \"class\": \"panel-title\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Files content\");\n  })), \"\\n\t\t\t\t\t\"), \"\\n\t\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n            \", HTML.DIV({\n    \"class\": \"post\"\n  }, \"\\n              \", HTML.P(HTML.A({\n    href: \"#\",\n    \"class\": \"scanFilesContent\",\n    title: function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"Scan all files for their content\");\n    }\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Scan all files for their content\");\n  }))), \"\\n              \", HTML.P(HTML.A({\n    href: \"#\",\n    \"class\": \"removeFilesContent\",\n    title: function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"Reset files content database\");\n    }\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Reset files content database\");\n  }))), \"\\n\t\t\t\t\t\t\"), \"\\n        \t\"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\");\n}));\n","Template.settingsFilesContent.events({\n  \"click a.scanFilesContent\": function (e) {\n    e.preventDefault();\n    Meteor.call(\"indexFilesContent\", function (error, results) {\n  \t\tif (error) {\n  \t\t  RKCore.log(\"error from the meteor call indexFilesContent :\");\n  \t\t  RKCore.log(error);\n      }\n      if (results){\n  \t\t  RKCore.log(\"results from the meteor call indexFilesContent :\");\n  \t\t  RKCore.log(results);\n  \t\t}\n    });\n    return false;\n  },\n  \"click a.removeFilesContent\": function (e) {\n    e.preventDefault();\n    Meteor.call(\"removeFilesContent\", function (error, results) {\n      if (error) {\n  \t\t  RKCore.log(\"error from the meteor call removeFilesContent :\");\n  \t\t  RKCore.log(error);\n      }\n      if (results){\n  \t\t  RKCore.log(\"results from the meteor call removeFilesContent :\");\n  \t\t  RKCore.log(results);\n  \t\t}\n    });\n    return false;\n  },\n});\n\n\nTemplate.settingsFilesContent.helpers({\n\n});\n","\nTemplate.__checkName(\"filesContentInSearchResults\");\nTemplate[\"filesContentInSearchResults\"] = new Template(\"Template.filesContentInSearchResults\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"post\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\t\", HTML.DIV({\n    \"class\": \"col-md-10\"\n  }, \"\\n\t\t\t\t\", HTML.P(Blaze.View(\"lookup:shortText\", function() {\n    return Spacebars.mustache(view.lookup(\"shortText\"));\n  })), \"\\n\t\t\t\"), \"\\n\t\t\t\", HTML.DIV({\n    \"class\": \"col-md-2\"\n  }, \"\\n\t\t\t\t\", HTML.SPAN({\n    \"class\": \"label label-default\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"File content\");\n  })), \"\\n\t\t\t\t\", HTML.Raw(\"<br>\"), \"\\n\t\t\t\t\", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"searchTypeIsFullTextSearch\"));\n  }, function() {\n    return [ \"\\n\t\t\t\t\t\", HTML.P(Blaze.View(\"lookup:_\", function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"Search score\");\n    }), \" : \", Blaze.View(\"lookup:textScore\", function() {\n      return Spacebars.mustache(view.lookup(\"textScore\"));\n    })), \"\\n\t\t\t\t\" ];\n  }), \"\\n\t\t\t\"), \"\\n\t\t\"), \"\\n\t\");\n}));\n","Template.filesContentInSearchResults.events({\n\t\"click .searchThisTag\": function (e, t) {\n\t\t\te.preventDefault();\n\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\tconsole.log(e.target.dataset.tag)\n\t\t\t}\n\t\t\tSession.set(\"searchQuery\",e.target.dataset.tag);\n\t\t\tdocument.getElementById(\"keywords\").value = e.target.dataset.tag ;\n\t\t\tSession.set(\"searchType\",\"regexpSearch\");\n\t\t\tdocument.getElementById(\"searchType\").value = \"regexpSearch\";\n      return false;\n  }\n});\n\n\nTemplate.filesContentInSearchResults.helpers({\n\tshortText: function() {\n\t\treturn this.text.substring(0, 500);\n\t},\n\tsearchTypeIsFullTextSearch: function () {\n\t\treturn (Session.get('searchType')==='fullTextSearch')\n\t},\n\tcategoryName: function (){\n\t\tvar Category = Categories.findOne(this.categoryId);\n\t\treturn Category.name;\n\t},\n\ttextScore: function (){\n\t\t//limit to 2 digits after comma :\n\t\treturn Math.round(this.score*100)/100;\n\t},\n\tfileLinkUrl: function () {\n\t\t\tfileLink = clientFilename(this.filePath);\n\t  \treturn fileLinkUrl = 'rk:'+fileLink;\n  },\n\tuserSpaceIcon: function () {\n\t\tif (userSpaceHasDoc(Meteor.userId(), this._id))\n\t\t\treturn 'glyphicon-star';\n\t\telse\n\t\t\treturn 'glyphicon-star-empty';\n\t},\n\tuserSpaceLinkTitle: function () {\n\t\tif (userSpaceHasDoc(Meteor.userId(), this._id))\n\t\t\treturn TAPi18n.__('Remove from my space');\n\t\telse\n\t\t\treturn TAPi18n.__('Add to my space');\n\t}\n});\n\nvar userSpaceHasDoc = function (userId, docId) {\n\treturn (userSpaces.find({docId: docId, userId: userId}).count() > 0);\n};\n","var _ = Package.underscore._,\n    package_name = \"rationalk:filecontent\",\n    namespace = \"rationalk:filecontent\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n// integrate the fallback language translations \ntranslations = {};\ntranslations[namespace] = {\"invitation_to_join_info_login\":\"Your username will be your company email.\"};\nTAPi18n._loadLangFileObject(\"en\", translations);\nvar package_templates = _.difference(_.keys(Template), non_package_templates);\n\nfor (var i = 0; i < package_templates.length; i++) {\n  var package_template = package_templates[i];\n\n  registerI18nTemplate(package_template);\n}\n","var _ = Package.underscore._,\n    package_name = \"rationalk:filecontent\",\n    namespace = \"rationalk:filecontent\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n"]}