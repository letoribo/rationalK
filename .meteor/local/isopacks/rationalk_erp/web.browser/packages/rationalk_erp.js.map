{"version":3,"sources":["rationalk:erp/lib/methods.js","rationalk:erp/lib/collections.js","rationalk:erp/lib/routes.js","rationalk:erp/lib/client/plan.html","rationalk:erp/lib/client/plan.js","rationalk:erp/lib/client/build.html","rationalk:erp/lib/client/build.js","rationalk:erp/lib/client/stocks.html","rationalk:erp/lib/client/stocks.js"],"names":[],"mappings":";;;;;;;;AAAA,W;;;AAGA,gB;AACA,sD;AACA,4B;AACA,6B;AACA,yC;AACA,4B;AACA,uB;AACA,wC;AACA,oD;AACA,8C;AACA,6B;AACA,0B;AACA,6B;AACA,yB;AACA,uD;AACA,oB;AACA,I;AACA,Y;AACA,gC;AACA,M;AACA,K;AACA,wC;AACA,I;AACA,I;AACA,mB;AACA,I;AACA,I;AACA,+C;AACA,2E;;;AAGA,kD;;;AAGA,uD;AACA,0C;AACA,sB;AACA,uC;AACA,+C;AACA,2C;AACA,sC;AACA,qC;AACA,yC;AACA,Q;AACA,6C;AACA,+C;AACA,gD;AACA,M;AACA,M;AACA,mC;AACA,gE;AACA,4C;AACA,4C;AACA,yB;AACA,uB;AACA,2B;AACA,Y;AACA,8C;AACA,K;AACA,I;AACA,qB;AACA,K;AACA,a;AACA,uB;AACA,O;AACA,M;AACA,K;AACA,4B;AACA,K;AACA,K;AACA,wB;;;;AAIA,oB;AACA,I;AACA,Y;AACA,uB;AACA,M;AACA,K;AACA,I;AACA,2J;AACA,K;AACA,I;AACA,mB;AACA,I;AACA,I;AACA,kD;AACA,wC;AACA,qB;AACA,qC;AACA,oE;AACA,G;AACA,G;AACA,qC;AACA,4B;AACA,qH;AACA,0C;AACA,kD;AACA,qB;AACA,sC;AACA,8C;AACA,6C;AACA,mD;AACA,qC;AACA,O;AACA,gD;AACA,yC;AACA,mD;AACA,M;AACA,iC;AACA,I;AACA,G;;AAEA,wC;AACA,qB;;AAEA,oB;AACA,I;AACA,Y;AACA,sB;AACA,M;AACA,K;AACA,I;AACA,2B;AACA,I;AACA,I;AACA,qC;AACA,mD;AACA,G;AACA,G;AACA,qC;AACA,oC;AACA,wC;AACA,oC;AACA,oC;AACA,8C;AACA,oC;AACA,kC;;AAEA,oB;AACA,I;AACA,Y;AACA,gC;AACA,M;AACA,K;AACA,I;AACA,wC;AACA,e;AACA,gB;AACA,sC;AACA,2B;AACA,qC;AACA,2B;AACA,yB;AACA,O;AACA,M;AACA,K;AACA,I;AACA,mB;AACA,I;AACA,I;AACA,qC;AACA,iF;AACA,G;AACA,G;AACA,uC;AACA,oC;AACA,oC;AACA,kD;AACA,wB;AACA,G;AACA,yE;AACA,2C;AACA,8C;AACA,uC;AACA,yC;;;AAGA,+D;AACA,oC;AACA,gC;AACA,G;AACA,0D;AACA,wD;AACA,qC;AACA,6C;AACA,+C;AACA,mD;AACA,8C;AACA,I;AACA,O;AACA,oD;AACA,4D;AACA,+C;AACA,K;AACA,K;AACA,uC;AACA,gC;AACA,M;AACA,kC;AACA,qD;AACA,uC;AACA,iE;AACA,mC;AACA,M;AACA,I;AACA,G;AACA,oB;AACA,M;AACA,c;AACA,wB;AACA,Q;AACA,O;AACA,M;AACA,0C;AACA,M;AACA,I;AACA,qC;AACA,iD;AACA,G;;;;AAIA,G;AACA,gD;AACA,6B;AACA,4B;AACA,qC;AACA,2B;AACA,G;AACA,oB;AACA,I;AACA,Y;AACA,gC;AACA,M;AACA,K;AACA,I;AACA,gD;AACA,0C;AACA,K;AACA,I;AACA,mB;AACA,I;AACA,I;AACA,qC;AACA,6D;AACA,G;AACA,G;AACA,sC;AACA,2B;AACA,8D;;AAEA,yD;AACA,gD;AACA,uC;AACA,mB;AACA,4B;AACA,yC;AACA,oC;AACA,qD;AACA,sC;AACA,wC;AACA,gD;AACA,6C;AACA,4E;AACA,2B;AACA,M;AACA,K;AACA,I;AACA,G;;AAEA,uC;AACA,wD;AACA,4B;AACA,uC;AACA,0B;AACA,yB;AACA,I;AACA,G;;;AAGA,6B;AACA,sC;AACA,iF;AACA,I;AACA,G;AACA,kC;AACA,sC;AACA,wF;AACA,I;AACA,G;AACA,Q;AACA,qC;AACA,uC;AACA,I;AACA,sC;AACA,sC;AACA,sD;AACA,I;AACA,G;AACA,E;AACA,G;;;;;;;;;;;;;;;;;;;ACjTA,gD;;AAEA,mB;AACA,iD;AACA,gD;AACA,kD;AACA,G;;AAEA,mC;AACA,8B;;;;;;;;;;;;;;;;;;;ACTA,sC;AACA,+B;AACA,mB;AACA,yB;AACA,8C;AACA,M;AACA,K;;AAEA,6B;AACA,iB;AACA,yB;AACA,c;AACA,uC;AACA,yD;AACA,Q;AACA,M;AACA,K;;AAEA,qC;AACA,kB;AACA,uB;AACA,iD;AACA,M;AACA,yB;AACA,8C;AACA,M;AACA,K;;;AAGA,sC;AACA,0C;AACA,sC;AACA,iD;AACA,8C;AACA,kE;AACA,wE;AACA,oD;AACA,I;;AAEA,0B;AACA,K;AACA,2B;AACA,sC;AACA,K;AACA,I;;AAEA,C;;;;;;;;;;;;;;;;;;;;AC7CA,6B;AACA,8D;AACA,kB;AACA,qB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,iL;AACA,yB;AACA,gD;AACA,Y;AACA,oE;AACA,yE;AACA,M;AACA,iB;AACA,mE;AACA,sE;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,8K;AACA,yB;AACA,mE;AACA,gE;AACA,4a;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,sL;AACA,yB;AACA,gD;AACA,Y;AACA,gE;AACA,qE;AACA,M;AACA,iB;AACA,mE;AACA,ukE;AACA,I;;;;;;;;;;;;;;;;;;;AC7CA,2C;AACA,6C;AACA,kC;AACA,2B;AACA,+B;AACA,Y;AACA,uC;AACA,uC;AACA,yC;AACA,8C;AACA,mD;AACA,wD;AACA,8D;AACA,6C;AACA,0C;AACA,iB;AACA,+C;AACA,O;AACA,M;AACA,K;AACA,I;AACA,G;;AAEA,uC;AACA,mC;AACA,6C;AACA,uC;;AAEA,yC;AACA,8C;AACA,mD;AACA,wD;;AAEA,4C;AACA,sD;AACA,4C;AACA,0C;;AAEA,iC;AACA,O;AACA,2B;AACA,+B;AACA,2B;AACA,qC;AACA,wB;AACA,S;AACA,M;AACA,K;AACA,I;AACA,G;;AAEA,oC;AACA,gC;AACA,2B;AACA,G;;AAEA,oB;AACA,E;;;AAGA,4C;AACA,6C;AACA,oC;AACA,yB;AACA,G;AACA,0B;AACA,kC;AACA,oC;AACA,yD;AACA,8B;AACA,yC;AACA,6C;AACA,2C;AACA,2C;AACA,iB;AACA,I;AACA,sC;AACA,G;AACA,oC;AACA,2B;AACA,G;;AAEA,yC;AACA,mC;AACA,6C;AACA,uC;AACA,yC;AACA,8C;AACA,mD;AACA,6C;AACA,2C;AACA,qD;AACA,2C;AACA,yC;;AAEA,uC;AACA,+B;AACA,8B;AACA,6B;AACA,M;AACA,kD;AACA,qD;AACA,+C;AACA,iB;AACA,M;AACA,0B;AACA,8B;AACA,4B;AACA,0B;AACA,oC;AACA,wB;AACA,0B;AACA,wB;AACA,iC;AACA,Q;AACA,K;AACA,kC;;AAEA,4D;AACA,4D;AACA,kE;AACA,0D;AACA,O;;;AAGA,I;AACA,G;;AAEA,0B;AACA,E;;;AAGA,sC;;AAEA,G;AACA,kE;AACA,c;AACA,kB;AACA,qB;AACA,U;AACA,oB;AACA,0C;AACA,G;AACA,I;;AAEA,oD;AACA,G;AACA,kC;AACA,6E;;AAEA,+C;AACA,gB;AACA,wB;AACA,kC;AACA,oC;AACA,kE;AACA,G;AACA,+D;AACA,qF;AACA,qE;AACA,gE;AACA,kE;AACA,sE;AACA,iE;AACA,oB;AACA,gB;AACA,c;AACA,0B;AACA,wE;AACA,2B;AACA,kB;AACA,a;AACA,G;AACA,E;AACA,mB;;AAEA,G;AACA,e;AACA,c;AACA,8G;AACA,4G;AACA,2G;AACA,U;AACA,e;AACA,kD;AACA,kD;AACA,kD;AACA,kD;AACA,S;AACA,M;AACA,G;;AAEA,0B;;AAEA,oB;;;AAGA,E;;AAEA,uB;AACA,kC;AACA,sD;AACA,4B;AACA,G;AACA,0C;AACA,gB;AACA,4B;AACA,6B;AACA,qD;AACA,uC;AACA,+B;AACA,qB;AACA,K;AACA,U;AACA,e;AACA,K;AACA,K;AACA,Y;AACA,Q;AACA,8B;AACA,gC;AACA,S;AACA,Q;AACA,iC;AACA,oC;AACA,S;AACA,M;AACA,4B;AACA,8B;AACA,S;AACA,Q;AACA,6B;AACA,gC;AACA,S;AACA,Q;AACA,4B;AACA,+B;AACA,S;AACA,M;AACA,2B;AACA,6B;AACA,S;AACA,Q;AACA,0B;AACA,4B;AACA,yC;AACA,6M;AACA,qB;AACA,6C;AACA,mC;AACA,gB;AACA,ggB;AACA,W;AACA,Q;AACA,I;AACA,G;AACA,I;AACA,gC;AACA,oD;AACA,oC;AACA,kC;AACA,G;;;AAGA,mB;AACA,mC;AACA,qC;AACA,mE;AACA,I;AACA,4B;AACA,2B;AACA,uB;AACA,4B;AACA,gE;AACA,sF;AACA,4B;AACA,sE;AACA,iE;AACA,mE;AACA,uE;AACA,6B;AACA,qE;AACA,8B;AACA,I;AACA,6B;AACA,6B;AACA,G;AACA,4B;AACA,uC;AACA,G;AACA,sC;AACA,gB;AACA,4B;AACA,6B;AACA,qD;AACA,uC;AACA,+B;AACA,qB;AACA,K;AACA,U;AACA,e;AACA,K;AACA,K;AACA,Y;AACA,Q;AACA,oC;AACA,gC;AACA,S;AACA,Q;AACA,4B;AACA,yB;AACA,S;AACA,Q;AACA,iC;AACA,+B;AACA,S;AACA,Q;AACA,wC;AACA,+B;AACA,S;AACA,Q;AACA,gC;AACA,8B;AACA,S;AACA,Q;AACA,0B;AACA,yB;AACA,Q;AACA,I;AACA,G;AACA,M;AACA,8B;;AAEA,oD;AACA,kC;;AAEA,6C;AACA,oC;AACA,yD;AACA,8B;AACA,yC;AACA,6C;AACA,2C;AACA,2C;AACA,iB;AACA,I;AACA,sC;AACA,G;AACA,oC;AACA,2B;AACA,G;AACA,4D;AACA,yD;AACA,2D;AACA,uD;AACA,yD;AACA,iE;;AAEA,gF;AACA,+F;AACA,yD;AACA,wD;AACA,wC;AACA,sC;AACA,wB;AACA,K;AACA,uC;AACA,yC;AACA,iD;AACA,mE;;AAEA,iE;AACA,oD;AACA,yC;AACA,uC;AACA,Q;AACA,kD;AACA,yC;AACA,sC;AACA,Q;AACA,0D;AACA,gF;AACA,uD;;AAEA,4B;AACA,uB;AACA,Q;AACA,a;AACA,wB;AACA,Q;;AAEA,2B;AACA,S;AACA,2C;AACA,iE;AACA,6C;AACA,mC;AACA,6C;AACA,+B;AACA,kN;AACA,uC;AACA,oC;AACA,S;AACA,S;AACA,O;AACA,Y;AACA,yC;AACA,yD;AACA,Q;AACA,O;;AAEA,4B;AACA,+B;AACA,qC;AACA,yC;;;AAGA,sD;AACA,wD;AACA,K;;AAEA,wB;AACA,E;AACA,G;;AAEA,sB;AACA,iC;AACA,4B;AACA,oB;AACA,0D;AACA,8D;AACA,oD;AACA,8D;AACA,oD;AACA,kD;;AAEA,kE;AACA,gB;AACA,qB;AACA,Y;AACA,uB;AACA,K;AACA,K;AACA,G;AACA,6C;AACA,4B;AACA,qC;AACA,wB;AACA,+C;AACA,I;AACA,gE;AACA,gC;AACA,iB;AACA,sB;AACA,a;AACA,wB;AACA,M;AACA,I;AACA,K;AACA,gB;AACA,E;AACA,G;;;;;;;;;;;;;;;;;;;;AC5cA,8B;AACA,gE;AACA,kB;AACA,qB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,0B;AACA,6B;AACA,8B;AACA,0B;AACA,0B;AACA,4E;AACA,0D;AACA,4C;AACA,yB;AACA,gD;AACA,Y;AACA,uD;AACA,4D;AACA,M;AACA,iB;AACA,mE;AACA,szC;AACA,I;;;;;;;;;;;;;;;;;;;AC3BA,uC;AACA,gC;AACA,0C;AACA,wC;AACA,E;;AAEA,wB;AACA,qB;AACA,sB;AACA,oB;AACA,G;AACA,6B;AACA,gB;AACA,8B;AACA,8B;AACA,oC;AACA,qD;AACA,Y;AACA,U;AACA,8B;AACA,gC;AACA,W;AACA,Q;AACA,8B;AACA,gC;AACA,S;AACA,Q;AACA,6B;AACA,+B;AACA,S;AACA,Q;AACA,iC;AACA,oC;AACA,S;AACA,Q;AACA,0B;AACA,4B;AACA,yC;AACA,wa;AACA,qB;AACA,6C;AACA,mC;AACA,gB;AACA,mgB;AACA,a;AACA,Q;AACA,I;AACA,G;AACA,K;AACA,G;;AAEA,uB;AACA,0C;AACA,4B;AACA,kC;;AAEA,oC;AACA,iB;AACA,qD;AACA,2D;AACA,mD;AACA,uB;AACA,kF;AACA,gB;AACA,qB;AACA,Y;AACA,uB;AACA,K;AACA,K;AACA,G;AACA,oC;AACA,4B;AACA,yB;AACA,8C;AACA,+G;;AAEA,yF;AACA,gB;AACA,qB;AACA,Y;AACA,uB;AACA,K;AACA,K;AACA,e;AACA,G;;AAEA,G;;;;;;;;;;;;;;;;;;;;ACrFA,+B;AACA,kE;AACA,kB;AACA,qB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,mK;AACA,yB;AACA,gD;AACA,Y;AACA,wD;AACA,6D;AACA,M;AACA,iB;AACA,mE;AACA,oD;AACA,mD;AACA,iB;AACA,yC;AACA,qB;AACA,uE;AACA,4D;AACA,+D;AACA,2D;AACA,qB;AACA,wB;AACA,iF;AACA,qD;AACA,Y;AACA,Q;AACA,gC;AACA,kB;AACA,8C;AACA,2B;AACA,sB;AACA,wB;AACA,gB;AACA,kC;AACA,kB;AACA,2C;AACA,2B;AACA,wC;AACA,iB;AACA,+F;AACA,ghC;AACA,I;;;;;;;;;;;;;;;;;;;ACjDA,wC;;AAEA,E;;AAEA,yB;AACA,sB;AACA,iE;AACA,kB;AACA,G;AACA,8B;AACA,gB;AACA,4B;AACA,6B;AACA,qD;AACA,uC;AACA,+B;AACA,qB;AACA,K;AACA,U;AACA,e;AACA,K;AACA,K;AACA,Y;AACA,Q;AACA,8B;AACA,gC;AACA,S;AACA,Q;AACA,6B;AACA,wB;AACA,S;AACA,Q;AACA,0B;AACA,4B;AACA,yC;AACA,2R;AACA,qB;AACA,6C;AACA,6B;AACA,gB;AACA,+T;AACA,a;AACA,Q;AACA,I;AACA,G;AACA,K;AACA,G;;AAEA,wB;AACA,0C;AACA,4B;AACA,kC;AACA,sD;AACA,yD;AACA,6E;AACA,gB;AACA,qB;AACA,Y;AACA,uB;AACA,K;AACA,K;AACA,G;AACA,oC;AACA,4B;AACA,8C;AACA,mG;AACA,gB;AACA,qB;AACA,Y;AACA,uB;AACA,K;AACA,K;AACA,e;AACA,E;AACA,G","file":"/packages/rationalk_erp.js","sourcesContent":["RKERP = {};\n\n\nMeteor.methods({\n\t\taddNeedToThisProduct: function (productId,dataset) {\n\t\t\tcheck(productId, String);\n\t\t\tcheck(dataset, Match.Any);\n\t\tconsole.log(\"Product Id : \"+productId);\n\t\tconsole.log(\"dataset : \");\n\t\tconsole.log(dataset);\n\t\tvar productName = dataset.productname;\n   \t    var productionStep = dataset.productionstep;\n\t\tvar productQty = Number(dataset.productqty);\n\t\tconsole.log('the need : ');\n\t\tconsole.log(productName)\n\t\tconsole.log(productionStep)\n\t\tconsole.log(productQty)\n\t\t// Create the needed product if it does not exist yet\n\t\tProduction.update(\n\t\t\t{\n\t\t\t  $and: [\n\t\t\t  \t{productName: productName}\n\t\t\t  ]\n\t\t\t},\n\t\t\t{ $set: { productName: productName} }\n\t\t\t,\n\t\t\t{\n\t\t\t    upsert: true\n\t\t\t}\n\t\t);\n\t\t// Get the id of the needed product (Balls) :\n\t\tvar neededProductId = Production.findOne({productName: productName})._id;\n\n\n\t\tvar needs = Production.findOne(productId).needs;\n\n\n\t\tif (typeof needs !== \"undefined\" && needs !== null) {\n\t\t\tconsole.log(\"Needs before removing :\");\n\t\t\tconsole.log(needs);\n\t\t\tvar needsArrayLength = needs.length;\n\t\t\tfor (var j = 0; j < needsArrayLength; j++) {\n\t\t\t\tconsole.log(\"current existing need :\");\n\t\t\t\tconsole.log(needs[j].productName);\n\t\t\t\tconsole.log(needs[j].productQty);\n\t\t\t\tconsole.log(needs[j].productionStep);\n\t\t\t\tif (\n\t\t\t\t\t(productName == needs[j].productName) &&\n\t\t\t\t\t(neededProductId == needs[j].productId) &&\n\t\t\t\t\t(productionStep == needs[j].productionStep)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar arrayElementToRemove = j;\n\t\t\t\t\t\tconsole.log('We need to remove/update the element : '+ j);\n\t\t\t\t\t\tconsole.log(\"Needs after removing :\");\n\t\t\t\t\t\tneeds.splice(arrayElementToRemove, 1);\n\t\t\t\t\t\tconsole.log(needs);\n\t\t\t\t\t\t//exit the loop :\n\t\t\t\t\t\tj=needsArrayLength+1;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"This need does not match.\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tProduction.update(\n\t\t\t\t{\n\t\t\t\t  $and: [\n\t\t\t\t  \t{_id: productId}\n\t\t\t\t  ]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t    $set: {needs: needs}\n\t\t\t\t}\n\t\t\t);\n\t\t} // end if have needs\n\n\n\n\t\tProduction.update(\n\t\t\t{\n\t\t\t  $and: [\n\t\t\t  \t{_id: productId},\n\t\t\t  ]\n\t\t\t},\n\t\t\t{\n\t\t\t    $push: { needs : {parentProductId:productId,productName:productName,productionStep:productionStep,productQty:productQty,productId:neededProductId} }\n\t\t\t},\n\t\t\t{\n\t\t\t    upsert: true\n\t\t\t}\n\t\t);\n\t\tvar needs = Production.findOne(productId).needs;\n\t\tconsole.log(\"Needs after updating :\");\n\t\tconsole.log(needs);\n\t\tif (typeof toastr !== \"undefined\"){\n\t\t\ttoastr.success('The product need has been updated successfully');\n\t\t}\n\t},\n\tdeleteThisNeed: function (dataset) {\n\t\tcheck(dataset, Match.Any);\n\t\t//dataset : {parentproductid: \"zzLmwhnteDGEmmDxD\", productname: \"Cage\", neededqty: \"1\", productionstep: \"Assembly\"}\n\t\tvar productId = dataset.parentproductid;\n\t\tvar needs = Production.findOne(productId).needs;\n\t\tconsole.log(needs);\n\t\tvar needsArrayLength = needs.length;\n\t\tfor (var j = 0; j < needsArrayLength; j++) {\n\t\t\tvar needProductName = dataset.productname;\n\t\t\tvar needProductionStep = dataset.productionstep;\n\t\t\tvar neededQty = dataset.neededqty;\n\t\t\tif (\n\t\t\t\t(needProductName == needs[j].productName) &&\n\t\t\t\t(neededQty == needs[j].productQty) &&\n\t\t\t\t(needProductionStep == needs[j].productionStep)\n\t\t\t\t){\n\t\t\t\tvar arrayElementToRemove = j;\n\t\t\t}\n\t\t}\n\n\t\tneeds.splice(arrayElementToRemove, 1);\n\t\tconsole.log(needs);\n\n\t\tProduction.update(\n\t\t\t{\n\t\t\t  $and: [\n\t\t\t  \t{_id: productId}\n\t\t\t  ]\n\t\t\t},\n\t\t\t{\n\t\t\t    $set: {needs: needs}\n\t\t\t}\n\t\t);\n\t\tif (typeof toastr !== \"undefined\"){\n\t\t\ttoastr.success('This product need has deleted');\n\t\t}\n\t},\n\tplanProduction: function (dataset) {\n\t\tcheck(dataset, Match.Any); //#todo\n\t\tvar productName = dataset.productName;\n\t\tvar productQty=dataset.productQty;\n\t\tvar startDate = dataset.startDate;\n\t\tvar productionStep = dataset.productionStep;\n\t\tvar ressource = dataset.ressource;\n\t\tvar duration = dataset.duration;\n\n\t\tProduction.update(\n\t\t\t{\n\t\t\t  $and: [\n\t\t\t  \t{productName: productName}\n\t\t\t  ]\n\t\t\t},\n\t\t\t{\n\t\t\t    $set: {productName: productName},\n\t\t\t    $push: {\n\t\t\t\t\t\tplanning:{\n\t\t\t\t\t\t\tproductQty: Number(productQty),\n\t\t\t\t\t\t\tstartDate:startDate,\n\t\t\t\t\t\t\tproductionStep:productionStep,\n\t\t\t\t\t\t\tressource:ressource,\n\t\t\t\t\t\t\tduration:duration,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t    upsert: true\n\t\t\t}\n\t\t);\n\t\tif (typeof toastr !== \"undefined\"){\n\t\t\ttoastr.success('The planning for this product has been updated successfully');\n\t\t}\n\t},\n\tdeleteProduction: function (dataset) {\n\t\tcheck(dataset, Match.Any); //#todo\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(\"Deleting production matching : \");\n\t\t\tconsole.log(dataset);\n\t\t}\n\t\tvar productId = dataset.productid; //que des miniscules dans le dataset\n\t    var productName = dataset.productname;\n\t\tvar productionStep = dataset.productionstep;\n\t    var startDate = dataset.startdate;\n\t    var plannedQty = dataset.plannedqty;\n\n\n\t\tvar productPlanning = Production.findOne(productId).planning;\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(productPlanning);\n\t\t}\n\t\tvar productPlanningArrayLength = productPlanning.length;\n\t\tfor (var j = 0; j < productPlanningArrayLength; j++) {\n\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\tconsole.log(\"Current planning entry : \");\n\t\t\t\tconsole.log(productPlanning[j].productQty);\n\t\t\t\tconsole.log(productPlanning[j].productionStep);\n\t\t\t\tconsole.log(productPlanning[j].startDate);\n\t\t\t}\n\t\t\tif (\n\t\t\t\t(plannedQty == productPlanning[j].productQty) &&\n\t\t\t\t(productionStep == productPlanning[j].productionStep) &&\n\t\t\t\t(startDate == productPlanning[j].startDate)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\tconsole.log(\"Remove : \"+j)\n\t\t\t\t\t}\n\t\t\t\t\tvar arrayElementToRemove = j;\n\t\t\t\t\tproductPlanning.splice(arrayElementToRemove, 1);\n\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\tconsole.log(\"After removing, the planning looks like : \"+j)\n\t\t\t\t\t\tconsole.log(productPlanning);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tProduction.update(\n\t\t\t\t\t{\n\t\t\t\t\t  $and: [\n\t\t\t\t\t  \t{_id: productId}\n\t\t\t\t\t  ]\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t    $set: {planning: productPlanning}\n\t\t\t\t\t}\n\t\t);\n\t\tif (typeof toastr !== \"undefined\"){\n\t\t\ttoastr.success('This event has been deleted');\n\t\t}\n\n\n\n\t},\n\taddToStock: function (productName,productQty) {\n\t\tcheck(productName, String);\n\t\tcheck(productQty, Number);\n\t\tif (Meteor.settings.public.debug) {\n\t\t\tconsole.log(productQty);\n\t\t}\n\t\tProduction.update(\n\t\t\t{\n\t\t\t  $and: [\n\t\t\t  \t{productName: productName}\n\t\t\t  ]\n\t\t\t},\n\t\t\t{\n\t\t\t    $inc: { productQty: Number(productQty) },\n\t\t\t    $set: { productName : productName }\n\t\t\t},\n\t\t\t{\n\t\t\t    upsert: true\n\t\t\t}\n\t\t);\n\t\tif (typeof toastr !== \"undefined\"){\n\t\t\ttoastr.success('The stock has been updated successfully');\n\t\t}\n\t},\n\tdeleteProduct: function (productId) {\n\t\tcheck(productId, String);\n\t\tvar productName = Production.findOne(productId).productName;\n\n\t\t//check if the product is not used in another product :\n\t\tvar allProducts = Production.find({}).fetch();\n\t\tvar arrayLength = allProducts.length;\n\t\tvar neededIn= \"\";\n\t\tvar neededSomewhere=false;\n\t\tfor (var i = 0; i < arrayLength; i++) {\n\t\t\tvar needs = allProducts[i].needs;\n\t\t\tvar parentProductName = allProducts[i].productName\n\t\t\tif (typeof needs !== \"undefined\") {\n\t\t\t\tvar needsArrayLength = needs.length;\n\t\t\t\tfor (var j = 0; j < needsArrayLength; j++) {\n\t\t\t\t\tif (productName== needs[j].productName){\n\t\t\t\t\t\tneededIn=neededIn + ((neededIn ==\"\") ? \"\" : \", \") + parentProductName;\n\t\t\t\t\t\tneededSomewhere=true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//check if the product is not planned\n\t\tvar planning = Production.findOne(productId).planning;\n\t\tvar plannedSomewhen=false;\n\t\tif (typeof planning !== \"undefined\"){\n\t\t\tif (planning.length>0){\n\t\t\t\tplannedSomewhen=true;\n\t\t\t}\n\t\t}\n\n\n\t\tif (neededSomewhere==true){\n\t\t\tif (typeof toastr !== \"undefined\"){\n\t\t\t\ttoastr.error(productName +' cannot be deleted since it used in : '+neededIn);\n\t\t\t}\n\t\t}\n\t\telse if (plannedSomewhen==true){\n\t\t\tif (typeof toastr !== \"undefined\"){\n\t\t\t\ttoastr.error(productName +' cannot be deleted since it is a production is planned');\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\tconsole.log(\"remove : \"+productId);\n\t\t\t}\n\t\t\tProduction.remove({_id:productId});\n\t\t\tif (typeof toastr !== \"undefined\"){\n\t\t\t\ttoastr.success(productName + ' has been deleted');\n\t\t\t}\n\t\t}\n\t}\n});\n","Production = new Mongo.Collection('production');\n\nProduction.allow( {\n\t\tinsert: function (userId) {return !! userId; },\n\t\tupdate: function (userId) {return !!userId; },\n    remove: function (userId) {return !!userId; },\n});\n\n//expose it to the other packages :\nRKERP.Production = Production;\n","if (Meteor.settings.public.show.erp) {\n  Router.route(\"/erp/stocks\", {\n    name: \"stocks\",\n    waitOn: function () {\n      return [Meteor.subscribe(\"production\")];\n    },\n  });\n\n  Router.route(\"/erp/plan\", {\n    name: \"plan\",\n    waitOn: function () {\n      return [\n        Meteor.subscribe(\"production\"),\n        //Meteor.subscribe(\"ressourcePlanningPublished\"),\n      ];\n    },\n  });\n\n  Router.route(\"/erp/product/:_id\", {\n    name: \"build\",\n    data: function () {\n      return Production.findOne(this.params._id);\n    },\n    waitOn: function () {\n      return [Meteor.subscribe(\"production\")];\n    },\n  });\n\n\n  urlPlan = Router.routes.plan.path();\n  urlStocks = Router.routes.stocks.path();\n  menuHTML = new Spacebars.SafeString(\n     '<li role=\"separator\" class=\"divider\"></li>'\n      + '<li class=\"dropdown-header\">ERP</li>'\n      + '<li><a href=\"' + urlPlan + '\" title=\"Plan\">Plan</a></li>'\n      + '<li><a href=\"' + urlStocks + '\" title=\"Stocks\">Stocks</a></li>'\n      + '<li role=\"separator\" class=\"divider\"></li>'\n  );\n\n  RKCore.packageMenu.push(\n    {\n      \"menuHTML\": menuHTML,\n      \"fromPackage\": \"rationalk:fmea\",\n    }\n  );\n\n}\n","\nTemplate.__checkName(\"plan\");\nTemplate[\"plan\"] = new Template(\"Template.plan\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.Raw('<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Production Planning</h3>\\n        \t\t</div>'), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", Blaze._TemplateWith(function() {\n    return {\n      collection: Spacebars.call(view.lookup(\"productionPlanning\")),\n      settings: Spacebars.call(view.lookup(\"settingsProductionPlanning\"))\n    };\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"reactiveTable\"));\n  }), \"\\n        \t\t\"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\"), \"\\n\t\", HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.Raw('<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Ressource Planning</h3>\\n        </div>'), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", Blaze.View(\"lookup:ressourcePlanning\", function() {\n    return Spacebars.mustache(view.lookup(\"ressourcePlanning\"));\n  }), \"\\n        \"), \"\\n  \t\t\"), \"\\n\t\t\"), \"\\n\t\"), HTML.Raw('\\n\t<div class=\"row\">\\n\t\t<div class=\"col-md-12\">\\n\t\t\t <div class=\"panel panel-default\">\\n\t\t\t \t<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Gantt</h3>\\n        </div>\\n\t\t\t\t<div class=\"panel-body\">\\n  \t\t\t\t<div id=\"gantt_here\" style=\"width: 100%; height: 500px;\"></div>\\n        </div>\\n  \t\t</div>\\n\t\t</div>\\n\t</div>\\n\t'), HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.Raw('<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Stock movements Forecast</h3>\\n        \t\t</div>'), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", Blaze._TemplateWith(function() {\n    return {\n      collection: Spacebars.call(view.lookup(\"stockMovements\")),\n      settings: Spacebars.call(view.lookup(\"settingsStockMovements\"))\n    };\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"reactiveTable\"));\n  }), \"\\n        \t\t\"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\"), HTML.Raw('\\n\t\t<div class=\"row\">\\n\t\t<div class=\"col-md-12\">\\n\t\t\t <div class=\"panel panel-default\">\\n\t\t\t \t<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Plan production</h3>\\n        \t\t</div>\\n\t\t\t\t<div class=\"panel-body\">\\n\t\t\t\t\t<form>\\n\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productName\">Product Name</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productName\" id=\"productName\" placeholder=\"Product Name\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productQty\">Quantity</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productQty\" id=\"productQty\" placeholder=\"100\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productionStep\">Production Step</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productionStep\" id=\"productionStep\" placeholder=\"Turning, Griding or Assembly\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t\t\t<div class=\"form-group\">\\n\t\t\t\t\t      <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t\t<label for=\"ressource\">Ressource</label>\\n\t\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"ressource\" id=\"ressource\" placeholder=\"Machine 1, Machine 2, John, Paul\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"startDate\">Start Date</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"startDate\" id=\"startDate\" placeholder=\"2015-02-18\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t\t\t<div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"duration\">Duration [Days]</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"duration\" id=\"duration\" placeholder=\"1\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\\n\t\t\t\t\t    <button type=\"submit\" class=\"btn btn-primary\">Plan</button>\\n\t\t\t\t    </form>\\n        \t\t</div>\\n    \t\t</div>\\n\t\t</div>\\n\t</div>') ];\n}));\n","var createRessourcePlanning = function () {\n\t\tvar Products = Production.find({}).fetch();\n\t\tvar nProducts = Products.length;\n\t\tvar ressourcesNames = [];\n\t\tvar Ressources = new Array();\n\t\tvar l = 0;\n\t\tfor (var i = 0; i < nProducts; i++) {\n\t\t\tvar planning = Products[i].planning;\n\t\t\tif (typeof planning !== \"undefined\") {\n\t\t\t\tvar planningArrayLength = planning.length;\n\t\t\t\tfor (var j = 0; j < planningArrayLength; j++) {\n\t\t\t\t\tif (typeof planning[j].ressource !== \"undefined\") {\n\t\t\t\t\t\tif (ressourcesNames.indexOf(planning[j].ressource)==-1){\n\t\t\t\t\t\t\tressourceName = planning[j].ressource;\n\t\t\t\t\t\t\tressourcesNames[l] = ressourceName;\n\t\t\t\t\t\t\tl = l + 1;\n\t\t\t\t\t\t\tRessources[ressourceName] = new Array();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < nProducts; i++) {\n\t\t\tvar productId = Products[i]._id;\n\t\t\tvar productName = Products[i].productName;\n\t\t\tvar planning = Products[i].planning;\n\n\t\t\tif (typeof planning !== \"undefined\") {\n\t\t\t\tvar planningArrayLength = planning.length;\n\t\t\t\tfor (var j = 0; j < planningArrayLength; j++) {\n\t\t\t\t\tif (typeof planning[j].ressource !== \"undefined\") {\n\n\t\t\t\t\t\tvar startDate = planning[j].startDate;\n\t\t\t\t\t\tvar productionStep = planning[j].productionStep;\n\t\t\t\t\t\tvar ressource = planning[j].ressource;\n\t\t\t\t\t\tvar duration = planning[j].duration;\n\n\t\t\t\t\t\tRessources[ressource].push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tproductId:productId,\n\t\t\t\t\t\t\tproductName:productName,\n\t\t\t\t\t\t\tstartDate:startDate,\n\t\t\t\t\t\t\tproductionStep:productionStep,\n\t\t\t\t\t\t\tduration:duration\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(\"Ressources : \");\n\t\t\tconsole.log(Ressources);\n\t\t}\n\n\t\treturn Ressources;\n};\n\n\nvar createProductionPlanning = function () {\n\t\tvar Products = Production.find({}).fetch();\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(Products);\n\t\t}\n\t\tvar Events= new Array();\n\t\tvar stockMovements= new Array();\n\t\tvar arrayLength = Products.length;\n\t\t//A first loop to store all actual product quantities :\n\t\tvar Quantities= new Array();\n\t\tfor (var i = 0; i < arrayLength; i++) {\n\t\t\tvar productName = Products[i].productName;\n\t\t\tvar productQty = Products[i].productQty;\n\t\t\tif (typeof productQty === \"undefined\") {\n\t\t\t\tproductQty=0;\n\t\t\t}\n\t\t\tQuantities[productName]=productQty;\n\t\t}\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(Quantities);\n\t\t}\n\n\t\tfor (var i = 0; i < arrayLength; i++) {\n\t\t\tvar productId = Products[i]._id;\n\t\t\tvar productName = Products[i].productName;\n\t\t\tvar planning = Products[i].planning;\n\t\t\tif (typeof planning !== \"undefined\") {\n\t\t\t\tvar planningArrayLength = planning.length;\n\t\t\t\tfor (var j = 0; j < planningArrayLength; j++) {\n\t\t\t\t\tvar plannedQty = planning[j].productQty;\n\t\t\t\t\tvar startDate = planning[j].startDate;\n\t\t\t\t\tvar productionStep = planning[j].productionStep;\n\t\t\t\t\tvar ressource = planning[j].ressource;\n\t\t\t\t\tvar duration = planning[j].duration;\n\n\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\tconsole.log(productName);\n\t\t\t\t\t\tconsole.log(plannedQty);\n\t\t\t\t\t\tconsole.log(startDate);\n\t\t\t\t\t}\n\t\t\t\t\tvar beforeEventQty = Quantities[productName];\n\t\t\t\t\tvar afterEventQty = beforeEventQty + plannedQty;\n\t\t\t\t\tQuantities[productName] =  afterEventQty ;\n\t\t\t\t\tEvents.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tproductId:productId,\n\t\t\t\t\t\tproductName:productName,\n\t\t\t\t\t\tplannedQty:plannedQty,\n\t\t\t\t\t\tstartDate:startDate,\n\t\t\t\t\t\tproductionStep:productionStep,\n\t\t\t\t\t\tduration:duration,\n\t\t\t\t\t\tressource:ressource,\n\t\t\t\t\t\ttype:\"Production\",\n\t\t\t\t\t\tafterEventQty:afterEventQty\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tvar productionEvents = Events;\n\n\t\t\t\tproductionEvents = productionEvents.sort(function (a,b){\n\t\t\t\t\t// Turn your strings into dates, and then subtract them\n\t\t\t\t\t// to get a value that is either negative, positive, or zero.\n\t\t\t\t\treturn new Date(a.startDate) - new Date(b.startDate);\n\t\t\t\t});\n\n\n\t\t\t}\n\t\t}\n\n\t\treturn productionEvents;\n};\n\n\nTemplate.plan.rendered = function () {\n\n\t/*\n\tMeteor.call('createRessourcePlanning', function (error, result) {\n\t\tif (error) {\n\t\t\t// handle error\n\t\t\tconsole.log(error)\n\t\t} else {\n\t\t\t// examine result\n\t\t\tSession.set('resourcePlanning',result);\n\t\t}\n\t});\n\n\tresourcePlanning = Session.get('resourcePlanning');\n\t*/\n\t//return resourcePlanning.find();\n\t// http://docs.dhtmlx.com/gantt/samples/02_extensions/08_tasks_grouping.html\n\n\tressourcePlanning = createRessourcePlanning();\n\tvar tasks = [];\n\tvar data = new Array();\n\tfor(var i in ressourcePlanning) {\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(\"key \" + i + \" has value \" + ressourcePlanning[i]);\n\t\t}\n\t\tvar ProductionPlannedForThisRessource = ressourcePlanning[i];\n\t\tProductionPlannedForThisRessourceLength = ProductionPlannedForThisRessource.length;\n\t\tfor (var j = 0; j < ProductionPlannedForThisRessourceLength; j++) {\n\t\t\tvar duration = ProductionPlannedForThisRessource[j].duration;\n\t\t\tvar startDate = ProductionPlannedForThisRessource[j].startDate;\n\t\t\tvar productName = ProductionPlannedForThisRessource[j].productName;\n\t\t\t//var m = moment(startDate,\"YYYY-MM-DD\").format(\"DD-MM-YYYY\");\n\t\t\t//console.log(m);\n\t\t\tvar obj = [];\n\t\t\tobj.id = l;\n\t\t\tobj.text = productName;\n\t\t\tobj.start_date = moment(startDate,\"YYYY-MM-DD\").format(\"DD-MM-YYYY\");\n\t\t\tobj.duration = duration;\n\t\t\tdata.push(obj);\n\t\t\tl = l + 1;\n\t\t}\n\t}\n\ttasks.data = data;\n\n\t/*\n\tvar tasks =  {\n        data:[\n            {id:1, text:\"Project #2\", start_date:\"01-04-2013\", duration:18,order:10,progress:0.4, open: true},\n            {id:2, text:\"Task #1\", \t  start_date:\"02-04-2013\", duration:8, order:10,progress:0.6, parent:1},\n            {id:3, text:\"Task #2\",    start_date:\"11-04-2013\", duration:8, order:20,progress:0.6, parent:1}\n        ],\n        links:[\n            { id:1, source:1, target:2, type:\"1\"},\n            { id:2, source:2, target:3, type:\"0\"},\n            { id:3, source:3, target:4, type:\"0\"},\n            { id:4, source:2, target:5, type:\"2\"},\n        ]\n    };\n\t*/\n\n\tgantt.init(\"gantt_here\");\n\n\tgantt.parse(tasks);\n\n\n};\n\nTemplate.plan.helpers({\n\tproductionPlanning: function () {\n\t\tvar productionPlanning = createProductionPlanning();\n\t\treturn productionPlanning;\n\t},\n\tsettingsProductionPlanning: function () {\n        return {\n            rowsPerPage: 10,\n            showFilter: true,\n            class: 'table table-condensed col-sm-12',\n            rowClass: function (item) {\n\t\t\t\tif (item.afterEventQty<=0){\n\t\t\t\t\treturn 'danger';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tfields: [\n\t\t\t    {\n\t\t\t        key: 'productName',\n\t\t\t        label: 'Product Name'\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'productionStep',\n\t\t\t        label: 'Production Step',\n\t\t\t    },\n\t\t\t\t\t{\n\t\t\t        key: 'ressource',\n\t\t\t        label: 'Ressource',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'plannedQty',\n\t\t\t        label: 'Planned Qty',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'startDate',\n\t\t\t        label: 'Start Date',\n\t\t\t    },\n\t\t\t\t\t{\n\t\t\t        key: 'duration',\n\t\t\t        label: 'Duration',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'actions',\n\t\t\t        label: 'Actions',\n\t\t\t        fn: function (value, object) {\n\t\t\t\t        \t//<a href=\"{{pathFor 'build' _id=productId}}\" title=\"Product Builder\"><span class=\"glyphicon glyphicon-eye-open\" aria-hidden=\"true\"></span></a>  this.productName,this.startDate,this.plannedQty\n\t\t\t\t        \tvar url;\n\t\t\t\t        \turl = Router.routes.build.path({\n\t\t\t\t\t        \t_id: object.productId\n\t\t\t\t\t        });\n\t\t\t\t\t\t\t\t\treturn new Spacebars.SafeString('<a href=\"' + url + '\" title=\"Product Builder\"><span class=\"glyphicon glyphicon-wrench\" aria-hidden=\"true\"></span></a> <a class=\"delete\" href=\"#\" data-productId=\"' + object.productId +'\" data-productName=\"' + object.productName +'\" data-productionStep=\"' + object.productionStep +'\" data-startDate=\"' + object.startDate +'\" data-plannedQty=\"' + object.plannedQty +'\" title=\"Delete this production\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span></a>');\n\t\t\t\t      }\n\t\t\t    }\n\t\t\t]\n\t\t}\n  },\n\tressourcePlanning: function (){\n\t\tvar ressourcePlanning = createRessourcePlanning();\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(ressourcePlanning);\n\t\t}\n\n\n\t\tvar str = '<ul>';\n\t\tfor(var i in ressourcePlanning) {\n\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\tconsole.log(\"key \" + i + \" has value \" + ressourcePlanning[i]);\n\t\t\t}\n\t\t\tstr = str.concat('<li>');\n\t\t\tstr = str.concat('<p>');\n\t\t\tstr = str.concat(i);\n\t\t\tstr = str.concat('</p>');\n\t\t\tvar ProductionPlannedForThisRessource = ressourcePlanning[i];\n\t\t\tProductionPlannedForThisRessourceLength = ProductionPlannedForThisRessource.length;\n\t\t\tstr = str.concat('<ul>');\n\t\t\tfor (var j = 0; j < ProductionPlannedForThisRessourceLength; j++) {\n\t\t\t\tvar duration = ProductionPlannedForThisRessource[j].duration;\n\t\t\t\tvar startDate = ProductionPlannedForThisRessource[j].startDate;\n\t\t\t\tvar productName = ProductionPlannedForThisRessource[j].productName;\n\t\t\t\tstr = str.concat('<li>');\n\t\t\t\tstr = str.concat(productName + \"/\" + startDate + \"/\" + duration);\n\t\t\t\tstr = str.concat('</li>');\n\t\t\t}\n\t\t\tstr = str.concat('</ul>');\n\t\t\tstr = str.concat('</li>');\n\t\t}\n\t\tstr = str.concat('</ul>');\n\t\treturn new Spacebars.SafeString(str);\n\t},\n\tsettingsStockMovements: function () {\n        return {\n            rowsPerPage: 10,\n            showFilter: true,\n            class: 'table table-condensed col-sm-12',\n            rowClass: function (item) {\n\t\t\t\tif (item.afterEventQty<=0){\n\t\t\t\t\treturn 'danger';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tfields: [\n\t\t\t    {\n\t\t\t        key: 'neededProductName',\n\t\t\t        label: 'Product Name'\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'startDate',\n\t\t\t        label: 'Date',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'beforeEventQty',\n\t\t\t        label: 'Qty before',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'totalNeededProductQty',\n\t\t\t        label: 'Qty needed',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'afterEventQty',\n\t\t\t        label: 'Qty after',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'comment',\n\t\t\t        label: 'Help',\n\t\t\t    }\n\t\t\t]\n\t\t}\n    },\n\tstockMovements: function () {\n\n\t\tvar productionEvents = createProductionPlanning();\n\t\tvar stockMovements= new Array();\n\n\t\tvar Products = Production.find({}).fetch();\n\t\tvar arrayLength = Products.length;\n\t\t//A first loop to store all actual product quantities :\n\t\tvar Quantities= new Array();\n\t\tfor (var i = 0; i < arrayLength; i++) {\n\t\t\tvar productName = Products[i].productName;\n\t\t\tvar productQty = Products[i].productQty;\n\t\t\tif (typeof productQty === \"undefined\") {\n\t\t\t\tproductQty=0;\n\t\t\t}\n\t\t\tQuantities[productName]=productQty;\n\t\t}\n\t\tif (Meteor.settings.public.debug){\n\t\t\tconsole.log(Quantities);\n\t\t}\n\t\tvar productionEventsArrayLength = productionEvents.length;\n\t\tfor (var i = 0; i < productionEventsArrayLength; i++) {\n\t\t\tvar parentProductName = productionEvents[i].productName;\n\t\t\tvar parentStartDate = productionEvents[i].startDate;\n\t\t\tvar parentPlannedQty = productionEvents[i].plannedQty;\n\t\t\tvar parentProductionStep = productionEvents[i].productionStep;\n\n\t\t\t// Pour chaque evenement de prod on va regarder les stocks que cela utilisent\n\t\t\tvar neededProducts = Production.find({productName:productionEvents[i].productName}).fetch();\n\t\t\tvar neededProductsArrayLength = neededProducts.length;\n\t\t\tfor (var k = 0; k < neededProductsArrayLength; k++) {\n\t\t\t\tvar needs = neededProducts[k].needs;\n\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\tconsole.log(needs);\n\t\t\t\t}\n\t\t\t\tif (typeof needs !== \"undefined\") {\n\t\t\t\t\tvar needsArrayLength = needs.length;\n\t\t\t\t\tfor (var l = 0; l < needsArrayLength; l++) {\n\t\t\t\t\t\tvar neededDuringThisProductionStep = needs[l].productionStep;\n\n\t\t\t\t\t\tif (parentProductionStep===neededDuringThisProductionStep){\n\t\t\t\t\t\t\tvar neededProductName = needs[l].productName;\n\t\t\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\t\t\tconsole.log(neededProductName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar neededProductQty = needs[l].productQty;\n\t\t\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\t\t\tconsole.log(neededProductQty);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar beforeEventQty = Quantities[neededProductName];\n\t\t\t\t\t\t\tvar afterEventQty = beforeEventQty - parentPlannedQty * neededProductQty;\n\t\t\t\t\t\t\tQuantities[neededProductName] =  afterEventQty ;\n\n\t\t\t\t\t\t\tif (afterEventQty<0){\n\t\t\t\t\t\t\t\tlabel=\"danger\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tlabel=\"default\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstockMovements.push(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tneededProductQty:neededProductQty,\n\t\t\t\t\t\t\t\t\ttotalNeededProductQty:parentPlannedQty*neededProductQty,\n\t\t\t\t\t\t\t\t\tneededProductName:neededProductName,\n\t\t\t\t\t\t\t\t\tstartDate:parentStartDate,\n\t\t\t\t\t\t\t\t\tproductionStep:parentProductionStep,\n\t\t\t\t\t\t\t\t\ttype:\"Stock movement\",\n\t\t\t\t\t\t\t\t\tcomment:\"Stock of \"+neededProductName +\" decreases for the production of \"+ parentPlannedQty+\" product(s) : \"+parentProductName+ \" at the step : \"+parentProductionStep+\" starting on :\"+parentStartDate,\n\t\t\t\t\t\t\t\t\tbeforeEventQty:beforeEventQty,\n\t\t\t\t\t\t\t\t\tafterEventQty:afterEventQty\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\t\t\t\t\tconsole.log(\"No needs in this production step \");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} //end loop over needs\n\t\t\t\t} // end if needs undefined\n\t\t\t} // end loop over needed products\n\t\t} //end loop over productionEvent array\n\n\n\t\tstockMovements = stockMovements.sort(function (a,b){\n\t\t\treturn new Date(a.startDate) - new Date(b.startDate);\n\t\t});\n\n\t\treturn stockMovements;\n\t}\n});\n\nTemplate.plan.events({\n\t'submit form': function (event){\n\t    event.preventDefault();\n\t    var dataset={};\n\t    dataset.productName = event.target.productName.value;\n\t\t\tdataset.productQty = Number(event.target.productQty.value);\n\t\t\tdataset.startDate = event.target.startDate.value;\n\t\t\tdataset.productionStep = event.target.productionStep.value;\n\t\t\tdataset.ressource = event.target.ressource.value;\n\t\t\tdataset.duration = event.target.duration.value;\n\n\t\tMeteor.call('planProduction',dataset, function (error, result) {\n\t\t  if (error) {\n\t\t    // handle error\n\t\t  } else {\n\t\t    // examine result\n\t\t  }\n\t\t});\n\t},\n\t\"click a.delete\": function (event,template){\n\t    event.preventDefault();\n\t\t\tif (Meteor.settings.public.debug){\n\t    \tconsole.log(this);\n\t    \tconsole.log(event.currentTarget.dataset);\n\t\t\t}\n\t    Meteor.call('deleteProduction',event.currentTarget.dataset,\n\t    \tfunction (error, result) {\n\t\t\t  if (error) {\n\t\t\t    // handle error\n\t\t\t  } else {\n\t\t\t    // examine result\n\t\t\t  }\n\t\t\t}\n\t\t\t);\n\t\t\treturn false;\n\t}\n});\n","\nTemplate.__checkName(\"build\");\nTemplate[\"build\"] = new Template(\"Template.build\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.DIV({\n    \"class\": \"panel-heading\",\n    style: \"position:relative\"\n  }, \"\\n\t\t\t \t\t\", HTML.H3({\n    \"class\": \"panel-title\"\n  }, \"Product Builder for : \", Blaze.View(\"lookup:productName\", function() {\n    return Spacebars.mustache(view.lookup(\"productName\"));\n  })), \"\\n        \t\t\"), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", Blaze._TemplateWith(function() {\n    return {\n      collection: Spacebars.call(view.lookup(\"Needs\")),\n      settings: Spacebars.call(view.lookup(\"settingsNeeds\"))\n    };\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"reactiveTable\"));\n  }), \"\t\t\t        \t\t\t\\n        \t\t\"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\"), HTML.Raw('\\n\t\t<div class=\"row\">\\n\t\t<div class=\"col-md-12\">\\n\t\t\t <div class=\"panel panel-default\">\\n\t\t\t \t<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Add need to this product</h3>\\n        \t\t</div>\\n\t\t\t\t<div class=\"panel-body\">\t\t\\n\t\t\t\t\t<form>\\n\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productName\">Product Name</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productName\" id=\"productName\" placeholder=\"Bearing 6000\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productionStep\">Production Step</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productionStep\" id=\"productionStep\" placeholder=\"Turning, Griding or Assembly\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productQty\">Quantity</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productQty\" id=\"productQty\" placeholder=\"100\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <button type=\"submit\" class=\"btn btn-primary\">Save</button>\\n\t\t\t\t    </form>\\n        \t\t</div>\\n    \t\t</div>\\n\t\t</div>\\n\t</div>') ];\n}));\n","Template.build.rendered = function () {\n\t var productId = this.data._id;\n\t var productName = this.data.productName;\n\t var productQty = this.data.productQty;\n};\n\nTemplate.build.helpers({\n\tNeeds: function () {\n\t\t//console.log(this);\n\t\treturn this.needs;\n\t},\n\tsettingsNeeds: function () {\n        return {\n            rowsPerPage: 1000,\n            showFilter: false,\n            showNavigation: 'never',\n            class: 'table table-condensed col-sm-12',\n\t\t\tfields: [\n\t\t\t    //{\n\t\t\t    //    key: 'productId',\n\t\t\t    //    label: 'Product Id'\n\t\t\t    //},\n\t\t\t    {\n\t\t\t        key: 'productName',\n\t\t\t        label: 'Product Name'\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'productQty',\n\t\t\t        label: 'Needed Qty',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'productionStep',\n\t\t\t        label: 'Production Step',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'actions',\n\t\t\t        label: 'Actions',\n\t\t\t        fn: function (value, object) {\n\t\t\t\t        \t//<a href=\"{{pathFor 'project' _id=this._id}}\" title=\"Open this project\"><span class=\"glyphicon glyphicon-eye-open\" aria-hidden=\"true\"></span></a> <a class=\"delete\" href=\"#\" data-parentProductId=\"{{../_id}}\" data-productName=\"{{productName}}\" data-neededQty=\"{{productQty}}\" data-productionStep=\"{{productionStep}}\" title=\"Delete this need\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span></a>\n\t\t\t\t        \tvar url;\n\t\t\t\t        \turl = Router.routes.build.path({\n\t\t\t\t\t        \t_id: object.productId\n\t\t\t\t\t        });\n\t\t\t\t\t\t\treturn new Spacebars.SafeString('<a href=\"' + url + '\" title=\"Product Builder\"><span class=\"glyphicon glyphicon-wrench\" aria-hidden=\"true\"></span></a> <a class=\"delete\" href=\"#\" data-parentProductId=\"' + object.parentProductId +'\" data-productId=\"' + object.productId +'\" data-productName=\"' + object.productName +'\" data-productionStep=\"' + object.productionStep +'\" data-neededQty=\"' + object.productQty +'\" title=\"Delete this need\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span></a>');\n\t\t\t\t       \t}\n\t\t\t    }\n\t\t\t]\n\t\t}\n    }\n});\n\nTemplate.build.events({\n\t'submit form': function (event,template){\n\t    event.preventDefault();\n\t    //console.log(template.data);\n\n\t\tvar productId = template.data._id;\n\t\tvar dataset ={}\n\t\tdataset.productname=event.target.productName.value;\n\t\tdataset.productionstep=event.target.productionStep.value;\n\t\tdataset.productqty=event.target.productQty.value;\n\t\tconsole.log(dataset);\n\t\tMeteor.call('addNeedToThisProduct',productId,dataset, function (error, result) {\n\t\t  if (error) {\n\t\t    // handle error\n\t\t  } else {\n\t\t    // examine result\n\t\t  }\n\t\t});\n\t},\n\t\"click a.delete\": function (event){\n\t    event.preventDefault();\n\t    //console.log(this);\n\t    console.log(event.currentTarget.dataset);\n\t    // {parentproductid: \"zzLmwhnteDGEmmDxD\", productname: \"Cage\", neededqty: \"1\", productionstep: \"Assembly\"}\n\n\t    Meteor.call('deleteThisNeed',event.currentTarget.dataset, function (error, result) {\n\t\t  if (error) {\n\t\t    // handle error\n\t\t  } else {\n\t\t    // examine result\n\t\t  }\n\t\t});\n\t\treturn false;\n\t},\n\n});\n","\nTemplate.__checkName(\"stocks\");\nTemplate[\"stocks\"] = new Template(\"Template.stocks\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.Raw('<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Stock</h3>\\n        \t\t</div>'), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", Blaze._TemplateWith(function() {\n    return {\n      collection: Spacebars.call(view.lookup(\"Stocks\")),\n      settings: Spacebars.call(view.lookup(\"settingsStocks\"))\n    };\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"reactiveTable\"));\n  }), \"\t\t        \t\t\\n\t\t\t\t\t\", Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"Products\"));\n  }, function() {\n    return [ \"\\n\t\t        \t\t\", HTML.DIV({\n      \"class\": \"post\"\n    }, \"\\n\t\t\t        \t\t\", Blaze.View(\"lookup:productName\", function() {\n      return Spacebars.mustache(view.lookup(\"productName\"));\n    }), \" Qty : \", Blaze.View(\"lookup:productQty\", function() {\n      return Spacebars.mustache(view.lookup(\"productQty\"));\n    }), \" \", HTML.A({\n      href: function() {\n        return Spacebars.mustache(view.lookup(\"pathFor\"), \"build\", Spacebars.kw({\n          _id: Spacebars.dot(view.lookup(\".\"), \"_id\")\n        }));\n      },\n      title: \"Open this project\"\n    }, HTML.SPAN({\n      \"class\": \"glyphicon glyphicon-eye-open\",\n      \"aria-hidden\": \"true\"\n    })), \" \", HTML.A({\n      \"class\": \"delete\",\n      href: \"#\",\n      title: \"Delete this project\"\n    }, HTML.SPAN({\n      \"class\": \"glyphicon glyphicon-trash\",\n      \"aria-hidden\": \"true\"\n    })), \"\\n\t\t\t        \t\"), \"\\n\t\t\t\t\t\" ];\n  }, function() {\n    return [ \"\\n\t\t\t\t\t\t\", HTML.P(\"There is nothing to show for the moment.\"), \"\\n\t\t        \t\" ];\n  }), \"\t\t\t        \t\t\t\\n        \t\t\"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\"), HTML.Raw('\\n\t\t<div class=\"row\">\\n\t\t<div class=\"col-md-12\">\\n\t\t\t <div class=\"panel panel-default\">\\n\t\t\t \t<div class=\"panel-heading\" style=\"position:relative\">\\n\t\t\t \t\t<h3 class=\"panel-title\">Add something to the stock</h3>\\n        \t\t</div>\\n\t\t\t\t<div class=\"panel-body\">\t\t\\n\t\t\t\t\t<form>\\n\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productName\">Product Name</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productName\" id=\"productName\" placeholder=\"Product Name\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <div class=\"form-group\">\\n\t\t\t\t\t        <div class=\"form-group\">\\n\t\t\t\t\t\t\t\t<label for=\"productQty\">Quantity</label>\\n\t\t\t\t\t\t\t\t<input type=\"text\" class=\"form-control\" name=\"productQty\" id=\"productQty\" placeholder=\"100\">\\n  \t\t\t\t\t\t\t</div>\\n\t\t\t\t\t    </div>\\n\t\t\t\t\t    <button type=\"submit\" class=\"btn btn-primary\">Add to stock</button>\\n\t\t\t\t    </form>\\n        \t\t</div>\\n    \t\t</div>\\n\t\t</div>\\n\t</div>') ];\n}));\n","Template.stocks.rendered = function () {\n\n};\n\nTemplate.stocks.helpers({\n\tStocks: function () {\n\t\tvar Products = Production.find({visible:{$ne: false}}).fetch();\n\t\treturn Products;\n\t},\n\tsettingsStocks: function () {\n        return {\n            rowsPerPage: 10,\n            showFilter: true,\n            class: 'table table-condensed col-sm-12',\n            rowClass: function (item) {\n\t\t\t\tif (item.afterEventQty<=0){\n\t\t\t\t\treturn 'danger';\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tfields: [\n\t\t\t    {\n\t\t\t        key: 'productName',\n\t\t\t        label: 'Product Name'\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'productQty',\n\t\t\t        label: 'Qty',\n\t\t\t    },\n\t\t\t    {\n\t\t\t        key: 'actions',\n\t\t\t        label: 'Actions',\n\t\t\t        fn: function (value, object) {\n\t\t\t\t        \t//<a href=\"{{pathFor 'build' _id=this._id}}\" title=\"Open this project\"><span class=\"glyphicon glyphicon-eye-open\" aria-hidden=\"true\"></span></a> <a class=\"delete\" href=\"#\" title=\"Delete this project\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span></a>\n\t\t\t\t        \tvar url;\n\t\t\t\t        \turl = Router.routes.build.path({\n\t\t\t\t\t        \t_id: object._id\n\t\t\t\t\t        });\n\t\t\t\t\t\t\treturn new Spacebars.SafeString('<a href=\"' + url + '\" title=\"Product Builder\"><span class=\"glyphicon glyphicon-wrench\" aria-hidden=\"true\"></span></a> <a class=\"delete\" href=\"#\" data-productId=\"' + object._id +'\" title=\"Remove from stock\"><span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span></a>');\n\t\t\t\t       \t}\n\t\t\t    }\n\t\t\t]\n\t\t}\n    }\n});\n\nTemplate.stocks.events({\n\t'submit form': function (event,template){\n\t    event.preventDefault();\n\t    //console.log(template.data);\n\t    var productName = event.target.productName.value;\n\t\tvar productQty = Number(event.target.productQty.value);\n\t\tMeteor.call('addToStock',productName,productQty, function (error, result) {\n\t\t  if (error) {\n\t\t    // handle error\n\t\t  } else {\n\t\t    // examine result\n\t\t  }\n\t\t});\n\t},\n\t\"click a.delete\": function (event){\n\t    event.preventDefault();\n\t    console.log(event.currentTarget.dataset);\n\t    Meteor.call('deleteProduct', event.currentTarget.dataset.productid, function (error, result) {\n\t\t  if (error) {\n\t\t    // handle error\n\t\t  } else {\n\t\t    // examine result\n\t\t  }\n\t\t});\n\t\treturn false;\n\t}\n});\n"]}