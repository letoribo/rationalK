{"version":3,"sources":["rationalk:trello/lib/methods.js","rationalk:trello/lib/collections.js","rationalk:trello/lib/routes.js","rationalk:trello/lib/client/trello.html","rationalk:trello/lib/client/trello.js","rationalk:trello/lib/client/trelloCardInSearchResults.html","rationalk:trello/lib/client/trelloCardInSearchResults.js","rationalk:trello/lib/client/trelloSettings.html"],"names":[],"mappings":";;;;;;;;AAAA,c;;AAEA,gC;AACA,sD;AACA,E;;AAEA,gD;AACA,gC;AACA,gB;AACA,+B;AACA,U;AACA,Q;AACA,kD;AACA,gD;AACA,kB;AACA,O;AACA,E;;AAEA,kC;AACA,4E;AACA,E;;;;;;;;;;;;;;;;;;;ACpBA,wC;;AAEA,e;AACA,iD;AACA,gD;AACA,kD;AACA,G;;AAEA,sB;AACA,gD;AACA,8D;AACA,E;AACA,O;AACA,kD;AACA,+D;AACA,E;AACA,C;AACA,iB;;AAEA,mC;AACA,yB;;;;;;;;;;;;;;;;;;;ACpBA,yC;AACA,2B;AACA,mB;AACA,yB;AACA,c;AACA,mC;AACA,oC;AACA,uC;AACA,Q;AACA,M;AACA,K;AACA,C;;;;;;;;;;;;;;;;;;;;ACVA,+B;AACA,kE;AACA,kB;AACA,qB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,yB;AACA,6B;AACA,8B;AACA,yB;AACA,0B;AACA,wC;AACA,iE;AACA,+K;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,0B;AACA,6B;AACA,8B;AACA,0B;AACA,0B;AACA,wC;AACA,kE;AACA,0C;AACA,yB;AACA,iD;AACA,Y;AACA,wD;AACA,6D;AACA,M;AACA,iB;AACA,mE;AACA,oD;AACA,I;;;;;;;;;;;;;;;;;;;ACxCA,wC;AACA,sF;;AAEA,kC;AACA,a;AACA,iC;AACA,e;;AAEA,2C;AACA,gC;AACA,2C;AACA,6B;AACA,uD;AACA,wC;AACA,iC;AACA,gC;AACA,wC;AACA,mC;AACA,M;AACA,yE;AACA,U;AACA,Y;AACA,2B;AACA,G;AACA,G;AACA,E;;AAEA,yB;AACA,sB;AACA,+B;AACA,G;AACA,8B;AACA,Y;AACA,yB;AACA,yB;AACA,iD;AACA,I;AACA,G;AACA,G;;AAEA,wB;AACA,qC;AACA,iD;AACA,qB;AACA,qE;AACA,e;AACA,G;AACA,G;;;;;;;;;;;;;;;;;;;;AC9CA,kD;AACA,wG;AACA,kB;AACA,mB;AACA,mB;AACA,uB;AACA,kB;AACA,wB;AACA,wB;AACA,4D;AACA,mD;AACA,oC;AACA,uB;AACA,0B;AACA,kC;AACA,2E;AACA,wD;AACA,qD;AACA,sB;AACA,oD;AACA,M;AACA,qB;AACA,uB;AACA,yE;AACA,K;AACA,uJ;AACA,qE;AACA,iB;AACA,6F;AACA,0D;AACA,oB;AACA,gC;AACA,I;;;;;;;;;;;;;;;;;;;ACjCA,2C;AACA,0C;AACA,sB;AACA,qC;AACA,qC;AACA,I;AACA,mD;AACA,qE;AACA,4C;AACA,gE;AACA,mB;AACA,I;AACA,G;;AAEA,4C;AACA,4B;AACA,wF;AACA,wE;AACA,G;AACA,wB;AACA,qC;AACA,G;AACA,0C;AACA,uD;AACA,G;AACA,2B;AACA,qD;AACA,uB;AACA,G;AACA,wB;AACA,mC;AACA,wC;AACA,G;AACA,2B;AACA,4C;AACA,wC;AACA,I;AACA,6B;AACA,iD;AACA,2B;AACA,M;AACA,iC;AACA,G;AACA,kC;AACA,iD;AACA,6C;AACA,M;AACA,wC;AACA,E;AACA,G;;AAEA,gD;AACA,sE;AACA,E;;;;;;;;;;;;;;;;;;;;ACpDA,uC;AACA,kF;AACA,kB;AACA,mB;AACA,kB;AACA,uB;AACA,wB;AACA,yB;AACA,kC;AACA,yB;AACA,6B;AACA,8B;AACA,yB;AACA,0B;AACA,wC;AACA,0D;AACA,sC;AACA,yB;AACA,wB;AACA,sB;AACA,kE;AACA,M;AACA,mB;AACA,sD;AACA,I","file":"/packages/rationalk_trello.js","sourcesContent":["RKTrello = {};\n\nRKTrello.findAll = function () {\n  return Trello.find({}, {sort: {score: -1}}).fetch();\n};\n\nRKTrello.findFullText = function (searchQuery) {\n  return RKTrello.Trello.find( {\n        $text: {\n          $search: searchQuery,\n        },\n    }, {\n        fields: { score: { $meta: 'textScore' } },\n        sort: { score: { $meta: 'textScore' } },\n        limit: 30,\n    });\n};\n\nRKTrello.findDummy = function () {\n  return Trello.find({$text: { $search: \"somethingthatyouwillneverfind\" }});\n};\n","Trello = new Mongo.Collection('Trello');\n\nTrello.allow( {\n\t\tinsert: function (userId) {return !! userId; },\n\t\tupdate: function (userId) {return !!userId; },\n    remove: function (userId) {return !!userId; },\n});\n\nif (Meteor.isServer) {\n\tif (typeof Trello.createIndex === 'function') {\n\t\tTrello.createIndex({ full: \"text\" }, { name: \"TextIndex\" });\n\t}\n\telse {\n\t\tif (typeof Trello._ensureIndex === 'function') {\n\t\t\tTrello._ensureIndex( { full: \"text\" }, {name: \"TextIndex\"});\n\t}\n}\n} //end if Server\n\n//expose it to the other packages :\nRKTrello.Trello = Trello;\n","if (Meteor.settings.public.show.trello) {\n  Router.route(\"/trello\", {\n    name: \"trello\",\n    waitOn: function () {\n      return [\n        Meteor.subscribe(\"trello\"),\n        Meteor.subscribe(\"members\"),\n        Meteor.subscribe(\"rkSettings\"),\n      ];\n    },\n  });\n}\n","\nTemplate.__checkName(\"trello\");\nTemplate[\"trello\"] = new Template(\"Template.trello\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-heading\",\n    style: \"position:relative\"\n  }, \"\\n\t\t\t\t\t\", HTML.H3({\n    \"class\": \"panel-title\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Trello Upload\");\n  })), \"\\n\t\t\t\t\"), \"\\n\t\t\t\t\", HTML.Raw('<div class=\"panel-body\">\\n\t\t\t\t\t<input type=\"file\" id=\"files\" name=\"files[]\">\\n\t\t\t\t</div>'), \"\\n\t\t\t\t\"), \"\\n\t\t\"), \"\\n\t\"), \"\\n\t\", HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t \t\", HTML.DIV({\n    \"class\": \"panel-heading\",\n    style: \"position:relative\"\n  }, \"\\n\t\t\t \t\t\", HTML.H3({\n    \"class\": \"panel-title\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Trello Content\");\n  })), \"\\n        \"), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\t\", Blaze._TemplateWith(function() {\n    return {\n      collection: Spacebars.call(view.lookup(\"Trello\")),\n      settings: Spacebars.call(view.lookup(\"settingsTrello\"))\n    };\n  }, function() {\n    return Spacebars.include(view.lookupTemplate(\"reactiveTable\"));\n  }), \"\\n        \"), \"\\n    \t\t\"), \"\\n\t\t\"), \"\\n\t\") ];\n}));\n","Template.trello.rendered = function () {\n\tdocument.getElementById('files').addEventListener('change', handleFileSelect, false);\n\n\tfunction handleFileSelect (evt) {\n\t\tvar reader;\n    var files = evt.target.files;\n\t\tf = files[0];\n\n    if (f.type.match('application/json')) {\n      reader = new FileReader();\n      reader.onload = (function (theFile) {\n        return function (e) {\n\t\t\t\t\tvar trelloBoardJSON = JSON.parse(e.target.result);\n\t\t\t\t\tif (Meteor.settings.public.debug) {\n\t\t\t\t\t\tconsole.log(\"Filename : \");\n\t\t\t\t\t\tconsole.log(theFile.name);\n\t\t\t\t\t\tconsole.log(\"trelloBoardJSON : \");\n\t\t\t\t\t\tconsole.log(trelloBoardJSON);\n\t\t\t\t\t}\n\t\t\t\t\tMeteor.call('loadTrelloBoardJSON', trelloBoardJSON, function () {});\n        };\n      })(f);\n      reader.readAsText(f);\n\t\t}\n  }\n};\n\nTemplate.trello.helpers({\n\tTrello: function () {\n\t\treturn Trello.find().fetch();\n\t},\n\tsettingsTrello: function () {\n    return {\n        rowsPerPage: 100,\n        showFilter: true,\n        class: 'table table-condensed col-sm-12',\n\t\t\t}\n\t},\n});\n\nTemplate.trello.events({\n\t\"click a.loadTrello\": function (e) {\n\t\tvar trelloJSONFilename = \"trello/myboard.json\";\n\t\te.preventDefault();\n\t\tMeteor.call('loadTrelloBoard', trelloJSONFilename, function () {});\n\t\treturn false;\n\t},\n});\n","\nTemplate.__checkName(\"trelloCardInSearchResults\");\nTemplate[\"trelloCardInSearchResults\"] = new Template(\"Template.trelloCardInSearchResults\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"post\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\t\", HTML.DIV({\n    \"class\": \"col-md-10\"\n  }, \"\\n\t\t\t\t\", HTML.P(Blaze.View(\"lookup:full\", function() {\n    return Spacebars.mustache(view.lookup(\"full\"));\n  })), \"\\n\t\t\t\"), \"\\n\t\t\t\", HTML.DIV({\n    \"class\": \"col-md-2\"\n  }, \"\\n\t\t\t\t\", HTML.SPAN({\n    \"class\": \"label label-default\"\n  }, \"Trello Card in board : \", Blaze.View(\"lookup:boardName\", function() {\n    return Spacebars.mustache(view.lookup(\"boardName\"));\n  })), \"\\n\t\t\t\t\", HTML.Raw(\"<br>\"), \"\\n\t\t\t\t\", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"url\"));\n    },\n    target: \"_blank\",\n    title: function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"Open Card in Trello\");\n    }\n  }, HTML.Raw('<span class=\"glyphicon glyphicon-folder-open\" aria-hidden=\"true\"></span>')), \"\\n\t\t\t\t\", HTML.Raw(\"<br>\"), \"\\n\t\t\t\t\", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"searchTypeIsFullTextSearch\"));\n  }, function() {\n    return [ \"\\n\t\t\t\t\t\", HTML.P(\"Search Score : \", Blaze.View(\"lookup:textScore\", function() {\n      return Spacebars.mustache(view.lookup(\"textScore\"));\n    })), \"\\n\t\t\t\t\" ];\n  }), \"\\n\t\t\t\"), \"\\n\t\t\"), \"\\n\t\");\n}));\n","Template.trelloCardInSearchResults.events({\n\t\"click .searchThisTag\": function (e, t) {\n\t\t\te.preventDefault();\n\t\t\tif (Meteor.settings.public.debug){\n\t\t\t\tconsole.log(e.target.dataset.tag)\n\t\t\t}\n\t\t\tSession.set(\"searchQuery\",e.target.dataset.tag);\n\t\t\tdocument.getElementById(\"keywords\").value = e.target.dataset.tag ;\n\t\t\tSession.set(\"searchType\",\"regexpSearch\");\n\t\t\tdocument.getElementById(\"searchType\").value = \"regexpSearch\";\n      return false;\n  },\n});\n\nTemplate.trelloCardInSearchResults.helpers({\n\tlastRevision: function () {\n\t\tvar lastRevision = Revisions.findOne({docId: this._id },{sort: { revisionNumber: -1}})\n  \treturn ((typeof lastRevision)!== 'undefined') ? lastRevision : false;\n\t},\n\tshortText: function() {\n\t\treturn this.text.substring(0, 500);\n\t},\n\tsearchTypeIsFullTextSearch: function () {\n\t\treturn (Session.get('searchType')==='fullTextSearch')\n\t},\n\tcategoryName: function (){\n\t\tvar Category = Categories.findOne(this.categoryId);\n\t\treturn Category.name;\n\t},\n\ttextScore: function (){\n\t\t//limit to 2 digits after comma :\n\t\treturn Math.round(this.score*100)/100;\n\t},\n\tfileLinkUrl: function () {\n\t\t\tfileLink = clientFilename(this.filePath);\n\t  \treturn fileLinkUrl = 'rk:'+fileLink;\n  },\n\tuserSpaceIcon: function () {\n\t\tif (userSpaceHasDoc(Meteor.userId(), this._id))\n\t\t\treturn 'glyphicon-star';\n\t\telse\n\t\t\treturn 'glyphicon-star-empty';\n\t},\n\tuserSpaceLinkTitle: function () {\n\t\tif (userSpaceHasDoc(Meteor.userId(), this._id))\n\t\t\treturn TAPi18n.__('Remove from my space');\n\t\telse\n\t\t\treturn TAPi18n.__('Add to my space');\n\t}\n});\n\nvar userSpaceHasDoc = function (userId, docId) {\n\treturn (userSpaces.find({docId: docId, userId: userId}).count() > 0);\n};\n","\nTemplate.__checkName(\"trelloSettings\");\nTemplate[\"trelloSettings\"] = new Template(\"Template.trelloSettings\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"row\"\n  }, \"\\n\t\t\", HTML.DIV({\n    \"class\": \"col-md-12\"\n  }, \"\\n\t\t\t \", HTML.DIV({\n    \"class\": \"panel panel-default\"\n  }, \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-heading\",\n    style: \"position:relative\"\n  }, \"\\n\t\t\t\t\t\", HTML.H3({\n    \"class\": \"panel-title\"\n  }, Blaze.View(\"lookup:_\", function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"Trello\");\n  })), \"\\n\t\t\t\t\"), \"\\n\t\t\t\t\", HTML.DIV({\n    \"class\": \"panel-body\"\n  }, \"\\n\t\t\t\t\t\", HTML.A({\n    href: function() {\n      return Spacebars.mustache(view.lookup(\"pathFor\"), \"trello\");\n    },\n    title: \"Trello\"\n  }, \"Trello\"), \"\\n\t\t\t\t\"), \"\\n\t\t\t\t\"), \"\\n\t\t\"), \"\\n\t\");\n}));\n"]}